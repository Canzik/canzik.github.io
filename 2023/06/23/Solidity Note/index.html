<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="author" content="Canzik"><meta name="desciption" content="ä¸–ç•Œä¸Šåªæœ‰ä¸€ç§çœŸæ­£çš„è‹±é›„ä¸»ä¹‰ï¼Œé‚£å°±æ˜¯åœ¨è®¤æ¸…ç”Ÿæ´»çš„çœŸç›¸åä¾ç„¶çƒ­çˆ±ç”Ÿæ´»ã€‚"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Solidity Note</title><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/normalize/3.0.3/normalize.min.css"><link rel="stylesheet" type="text/css" href="/css/carbon.css"><script defer="defer" src="//cdn.jsdelivr.net/jquery/2.1.4/jquery.min.js"></script><script defer="defer" src="//cdn.jsdelivr.net/jquery.pjax/1.9.5/jquery.pjax.min.js"></script><link rel="stylesheet" href="//cdn.jsdelivr.net/fancybox/2.1.5/jquery.fancybox.css" type="text/css" media="screen"><script defer="defer" type="text/javascript" src="//cdn.jsdelivr.net/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script>var performFancybox = true;</script><script>var doRenderMath = 'mathjax'</script><!--mathjax config similar to math.stackexchange--><script type="text/x-mathjax-config">MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [ ['$','$'], ["\\(","\\)"] ],
    displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
    processEscapes: true
  }
});</script><script type="text/x-mathjax-config">MathJax.Hub.Config({
  tex2jax: {
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
  }
});</script><script async type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script defer="defer" src="/js/carbon.js"></script><meta name="generator" content="Hexo 6.0.0"></head><body><div id="container"><div id="banner"><h1 id="site-title"><a href="/">Canzik's Blog</a></h1><p id="site-subtitle"></p></div><div id="content"><div class="meta"><h2 class="article-title"><a href="/2023/06/23/Solidity%20Note">Solidity Note</a></h2><div class="article-date"><a href="javascript:void(0);" class="extra-switch">2023-06-23</a></div></div><div class="extra"><span class="Tags">Tags: <a href="/tags/Blockchain/">Blockchain</a>.</span></div><div class="extra"><span class="Categories">Categories: <a href="/categories/notes/">notes</a>.</span></div><div class="article-content"><div class="gallery"></div><p>ç²—æµ…åœ°å­¦ä¹ äº†ä¸€ä¸‹solidity</p>
<span id="more"></span>
<h2 id="ç®€å•çš„æ™ºèƒ½åˆçº¦">ç®€å•çš„æ™ºèƒ½åˆçº¦</h2>
<p>Solidityä¸­æ™ºèƒ½åˆçº¦çš„å«ä¹‰å°±æ˜¯ä¸€ç»„ä»£ç ï¼ˆå®ƒçš„Â <em>åŠŸèƒ½</em>Â )å’Œæ•°æ®ï¼ˆå®ƒçš„Â <em>çŠ¶æ€</em>ï¼‰çš„é›†åˆï¼Œå¹¶ä¸”å®ƒä»¬æ˜¯ä½äºä»¥å¤ªåŠåŒºå—é“¾çš„ä¸€ä¸ªç‰¹å®šåœ°å€ä¸Šçš„</p>
<p><strong>å­˜å‚¨åˆçº¦ç¤ºä¾‹</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">// SPDX-License-Identifier: GPL-3.0</span><br><span class="line">pragma solidity &gt;=0.4.16 &lt;0.9.0;  //å£°æ˜ç‰ˆæœ¬èŒƒå›´</span><br><span class="line"></span><br><span class="line">contract SimpleStorage &#123;</span><br><span class="line">    uint storedData;  //uint 256ä½æ— ç¬¦å·æ•´æ•°</span><br><span class="line"></span><br><span class="line">    function set(uint x) public &#123;</span><br><span class="line">        storedData = x;   //solidityä¸­ä¸éœ€è¦ç”¨this.è®¿é—®</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function get() public view returns (uint) &#123;</span><br><span class="line">        return storedData;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>set</code>ï¼šä¿®æ”¹å˜é‡storeDataçš„å€¼</p>
<p><code>get</code>ï¼šæ£€ç´¢å˜é‡storeDataçš„å€¼</p>
<p>è¿™ä¸ªç®€å•çš„åˆçº¦å…è®¸ä»»ä½•äººåœ¨åˆçº¦ä¸­å­˜å‚¨ä¸€ä¸ªå•ç‹¬çš„æ•°å­—ï¼Œå¹¶ä¸”è¿™ä¸ªæ•°å­—å¯ä»¥è¢«ä»»ä½•äººè®¿é—®ï¼Œä¸”æ²¡æœ‰å¯è¡Œçš„æ–¹æ³•é˜»æ­¢è¿™ä¸ªæ•°å­—çš„å‘å¸ƒ</p>
<p>****è´§å¸åˆçº¦ï¼ˆSubcurrencyï¼‰ç¤ºä¾‹****</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">// SPDX-License-Identifier: GPL-3.0pragma solidity ^0.8.4;</span><br><span class="line"></span><br><span class="line">contract Coin &#123;</span><br><span class="line">    // å…³é”®å­—â€œpublicâ€è®©è¿™äº›å˜é‡å¯ä»¥ä»å¤–éƒ¨è¯»å–    </span><br><span class="line">    address public minter;</span><br><span class="line">    mapping (address =&gt; uint) public balances;</span><br><span class="line"></span><br><span class="line">    // è½»å®¢æˆ·ç«¯å¯ä»¥é€šè¿‡äº‹ä»¶é’ˆå¯¹å˜åŒ–ä½œå‡ºé«˜æ•ˆçš„ååº”    </span><br><span class="line">    event Sent(address from, address to, uint amount);</span><br><span class="line"></span><br><span class="line">    // è¿™æ˜¯æ„é€ å‡½æ•°ï¼Œåªæœ‰å½“åˆçº¦åˆ›å»ºæ—¶è¿è¡Œ    </span><br><span class="line">    constructor() &#123;</span><br><span class="line">        minter = msg.sender;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function mint(address receiver, uint amount) public &#123;</span><br><span class="line">        require(msg.sender == minter);</span><br><span class="line">        balances[receiver] += amount;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">   // Errors allow you to provide information about</span><br><span class="line">   // why an operation failed. They are returned</span><br><span class="line">   // to the caller of the function.    </span><br><span class="line">   error InsufficientBalance(uint requested, uint available);</span><br><span class="line"></span><br><span class="line">    function send(address receiver, uint amount) public &#123;</span><br><span class="line">        if (amount &gt; balances[msg.sender])</span><br><span class="line">            revert InsufficientBalance(&#123;</span><br><span class="line">                requested: amount,</span><br><span class="line">                available: balances[msg.sender]</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line">        balances[msg.sender] -= amount;</span><br><span class="line">        balances[receiver] += amount;</span><br><span class="line">        emit Sent(msg.sender, receiver, amount);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>address public minter</code>ï¼š</p>
<p>addressæ˜¯ä¸ª160ä½çš„å€¼ï¼Œä¸”ä¸å…è®¸ä»»ä½•ç®—æ•°æ“ä½œã€‚å…³é”®å­—<code>public</code>è‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªå‡½æ•°ï¼Œå…è®¸åœ¨æ­¤åˆçº¦ä¹‹å¤–è®¿é—®è¿™ä¸ªçŠ¶æ€å˜é‡çš„å½“å‰å€¼ã€‚publicä¼šç”±ç¼–è¯‘å™¨è‡ªåŠ¨ç”Ÿæˆä¸€æ®µå‡½æ•°ï¼Œä»£ç å¤§è‡´å¦‚ä¸‹ï¼ˆæš‚æ—¶å¿½ç•¥
external å’Œ viewï¼‰ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">function minter() external view returns (address) &#123; return minter; &#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨ä½¿ç”¨publicåå†åŠ ä¸Šè¿™æ®µä»£ç ä¼šé€ æˆå†²çªï¼Œä¼šå‡ºç°åŒåçš„ä¸€ä¸ªå‡½æ•°å’Œä¸€ä¸ªå˜é‡</p>
<p><code>mapping (address =&gt; uint) public balances</code>ï¼š</p>
<p>mappingç±»å‹ï¼Œå°†addressæ˜ å°„ä¸ºæ— ç¬¦å·æ•´æ•°ï¼ˆuintï¼‰ã€‚åœ¨ä½¿ç”¨mappingæ—¶ï¼Œè¦ä¹ˆè®°ä½ä½ æ·»åŠ åˆ°mappingä¸­çš„æ•°æ®ï¼ˆä½¿ç”¨åˆ—è¡¨æˆ–æ›´é«˜çº§çš„æ•°æ®ç±»å‹ä¼šæ›´å¥½ï¼‰ï¼Œè¦ä¹ˆåœ¨ä¸éœ€è¦é”®åˆ—è¡¨æˆ–å€¼åˆ—è¡¨çš„ä¸Šä¸‹æ–‡ä¸­ä½¿ç”¨å®ƒã€‚è¿™é‡Œç”±publicç”Ÿæˆçš„å‡½æ•°è¦æ›´åŠ å¤æ‚ä¸€ç‚¹ï¼Œå¤§è‡´å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">function balances(address account) external view returns (uint) &#123;</span><br><span class="line">    return balances[account];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥å¾ˆè½»æ¾çš„æŸ¥è¯¢è´¦æˆ·çš„ä½™é¢</p>
<p><code>event Sent(address from, address to, uint amount)</code>ï¼š</p>
<p>è¿™è¡Œå£°æ˜äº†ä¸€ä¸ªæ‰€è°“çš„â€œäº‹ä»¶ï¼ˆeventï¼‰â€ï¼Œå®ƒä¼šåœ¨Â <code>send</code>Â å‡½æ•°çš„æœ€åä¸€è¡Œè¢«å‘å‡ºã€‚ç”¨æˆ·ç•Œé¢ï¼ˆå½“ç„¶ä¹ŸåŒ…æ‹¬æœåŠ¡å™¨åº”ç”¨ç¨‹åºï¼‰å¯ä»¥ç›‘å¬åŒºå—é“¾ä¸Šæ­£åœ¨å‘é€çš„äº‹ä»¶ï¼Œè€Œä¸ä¼šèŠ±è´¹å¤ªå¤šæˆæœ¬ã€‚ä¸€æ—¦å®ƒè¢«å‘å‡ºï¼Œç›‘å¬è¯¥äº‹ä»¶çš„listeneréƒ½å°†æ”¶åˆ°é€šçŸ¥ã€‚è€Œæ‰€æœ‰çš„äº‹ä»¶éƒ½åŒ…å«äº†Â <code>from</code>Â ï¼ŒÂ <code>to</code>Â å’ŒÂ <code>amount</code>Â ä¸‰ä¸ªå‚æ•°ï¼Œå¯æ–¹ä¾¿è¿½è¸ªäº¤æ˜“ã€‚</p>
<p>ä¸ºäº†ç›‘å¬è¿™ä¸ªäº‹ä»¶ï¼Œä½ å¯ä»¥ä½¿ç”¨å¦‚ä¸‹JavaScriptä»£ç ï¼Œ Coin æ˜¯é€šè¿‡Â web3.js
åˆ›å»ºçš„åˆçº¦å¯¹è±¡Â  :</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Coin</span>.<span class="title class_">Sent</span>().<span class="title function_">watch</span>(&#123;&#125;, <span class="string">&#x27;&#x27;</span>,<span class="keyword">function</span>(<span class="params">error, result</span>) &#123;</span><br><span class="line"><span class="keyword">if</span> (!error) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Coin transfer: &quot;</span> + result.<span class="property">args</span>.<span class="property">amount</span> +</span><br><span class="line">            <span class="string">&quot; coins were sent from &quot;</span> + result.<span class="property">args</span>.<span class="property">from</span> +</span><br><span class="line">            <span class="string">&quot; to &quot;</span> + result.<span class="property">args</span>.<span class="property">to</span> + <span class="string">&quot;.&quot;</span>);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Balances now:\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;Sender: &quot;</span> + <span class="title class_">Coin</span>.<span class="property">balances</span>.<span class="title function_">call</span>(result.<span class="property">args</span>.<span class="property">from</span>) +</span><br><span class="line">            <span class="string">&quot;Receiver: &quot;</span> + <span class="title class_">Coin</span>.<span class="property">balances</span>.<span class="title function_">call</span>(result.<span class="property">args</span>.<span class="property">to</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><del>æä¸æ‡‚eventï¼Œèœçš„æ‰£è„š</del></p>
<p><code>constructor</code>ï¼š</p>
<p>åˆ›å»ºåˆçº¦æœŸé—´è¿è¡Œçš„æ„é€ å‡½æ•°ï¼Œä¸èƒ½åœ¨åˆ›å»ºåè°ƒç”¨ã€‚æ­¤åˆçº¦ä¸­æ„é€ å‡½æ•°ç”¨æ¥æ°¸ä¹…å­˜å‚¨åˆ›å»ºåˆçº¦çš„äººçš„åœ°å€<code>msg</code>ã€‚<code>msg.sender</code>å§‹ç»ˆè®°å½•å½“å‰ï¼ˆå¤–éƒ¨ï¼‰å‡½æ•°è°ƒç”¨æ˜¯æ¥è‡ªäºå“ªä¸€ä¸ªåœ°å€</p>
<p><code>mint</code>ï¼š</p>
<p>mintå‡½æ•°ç”¨æ¥æ–°å‘è¡Œä¸€å®šçš„å¸åˆ°ä¸€ä¸ªæ–°åœ°å€ã€‚<code>require</code>ç”¨æ¥æ£€æŸ¥æŸäº›æ¡ä»¶ï¼Œä¸æ»¡è¶³å°±ä¼šå›æ¨æ‰€æœ‰çš„çŠ¶æ€å˜åŒ–ã€‚åœ¨è¿™ä¸ªåˆçº¦ä¸­ï¼Œ<code>require(msg.sender == minter)</code>ç¡®ä¿åªæœ‰åˆçº¦åˆ›å»ºè€…å¯ä»¥è°ƒç”¨<code>mint</code>ã€‚å½“<code>balances[receiver] += amount</code>çš„å€¼å¤§äº<code>uint</code>ï¼ˆ2**256-1ï¼‰ï¼Œç§°ä¸ºæº¢å‡ºäº¤æ˜“ï¼Œæº¢å‡ºäº¤æ˜“å°†è¢«è¿˜åŸ</p>
<p><code>error</code>ï¼š</p>
<p>æè¿°é”™è¯¯ä¿¡æ¯ï¼Œä¸€èˆ¬å’Œ<code>revert</code>ä¸€èµ·ä½¿ç”¨ã€‚<code>revert</code>è¯­å¥æ— æ¡ä»¶åœ°ä¸­æ­¢æ‰§è¡Œå¹¶å›é€€æ‰€æœ‰çš„å˜åŒ–ï¼Œç±»ä¼¼äºÂ <code>require</code>å‡½æ•°ï¼Œå®ƒä¹ŸåŒæ ·å…è®¸ä½ æä¾›ä¸€ä¸ªé”™è¯¯çš„åç§°å’Œé¢å¤–çš„æ•°æ®ï¼Œè¿™äº›é¢å¤–æ•°æ®å°†æä¾›ç»™è°ƒç”¨è€…(å¹¶æœ€ç»ˆæä¾›ç»™å‰ç«¯åº”ç”¨ç¨‹åºæˆ–åŒºå—èµ„æºç®¡ç†å™¨ï¼‰ã€‚erroræ˜¯ä¸€ä¸ªä¸“é—¨ç”¨æ¥è¿”å›é”™è¯¯ï¼Œå¹¶ä¸”å¯ä»¥è‡ªå®šä¹‰è¿”å›å†…å®¹çš„ç±»å‹</p>
<p><code>send</code>ï¼š</p>
<p>è¿›è¡Œäº¤æ˜“çš„å‡½æ•°ã€‚æ­¤åˆçº¦ä¸­å…ˆåˆ¤æ–­å‘é€è€…çš„è´¦æˆ·ä¸Šæ˜¯å¦æœ‰è¶³å¤Ÿçš„ä½™é¢ï¼Œä½™é¢ä¸è¶³ç”¨<code>revert</code>è¯­å¥ä¸­æ­¢å¹¶å›é€€ã€‚ä½™é¢è¶³å¤Ÿåˆ™è¿›è¡Œè´¦æˆ·çš„äº¤æ˜“ã€‚äº¤æ˜“ç»“æŸåï¼Œä½¿ç”¨<code>emit</code>å…³é”®å­—è§¦å‘äº‹ä»¶</p>
<p><code>~~emit</code>å’Œ<code>evnet</code>éƒ½ä¸æ˜¯å¾ˆæ‡‚~~</p>
<h2 id="knowledge-point">Knowledge point</h2>
<p><strong>çŠ¶æ€å˜é‡ã€å±€éƒ¨å˜é‡ã€å…¨å±€å˜é‡</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^0.5.0;</span><br><span class="line"></span><br><span class="line">contract SolidityTest &#123;</span><br><span class="line">   uint storedData; // çŠ¶æ€å˜é‡</span><br><span class="line">   constructor() public &#123;</span><br><span class="line">      storedData = 10;   </span><br><span class="line">   &#125;</span><br><span class="line">   function getResult() public view returns(uint)&#123;</span><br><span class="line">      uint a = 1; // å±€éƒ¨å˜é‡</span><br><span class="line">      uint b = 2;</span><br><span class="line">      uint result = a + b;</span><br><span class="line">      return result; // è®¿é—®å±€éƒ¨å˜é‡</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>çŠ¶æ€å˜é‡ï¼šå˜é‡å€¼æ°¸ä¹…ä¿å­˜åœ¨åˆçº¦å­˜å‚¨ç©ºé—´ä¸­çš„å˜é‡</li>
<li>å±€éƒ¨å˜é‡ï¼šå˜é‡å€¼ä»…åœ¨å‡½æ•°æ‰§è¡Œè¿‡ç¨‹ä¸­æœ‰æ•ˆçš„å˜é‡ï¼Œå‡½æ•°é€€å‡ºåï¼Œå˜é‡æ— æ•ˆ</li>
<li>å…¨å±€å˜é‡ï¼šå…¨å±€å·¥ä½œåŒºä¸­å­˜åœ¨çš„ç‰¹æ®Šå˜é‡ï¼Œæä¾›æœ‰å…³åŒºå—é“¾å’Œäº¤æ˜“å±æ€§çš„ä¿¡æ¯</li>
</ul>
<table>
<colgroup>
<col style="width: 44%" />
<col style="width: 55%" />
</colgroup>
<thead>
<tr class="header">
<th>åç§°</th>
<th>è¿”å›</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>blockhash(uint blockNumber) returns (bytes32)</td>
<td>ç»™å®šåŒºå—çš„å“ˆå¸Œå€¼ â€“ åªé€‚ç”¨äº256æœ€è¿‘åŒºå—, ä¸åŒ…å«å½“å‰åŒºå—ã€‚</td>
</tr>
<tr class="even">
<td>block.coinbase (address payable)</td>
<td>å½“å‰åŒºå—çŸ¿å·¥çš„åœ°å€</td>
</tr>
<tr class="odd">
<td>block.difficulty (uint)</td>
<td>å½“å‰åŒºå—çš„éš¾åº¦</td>
</tr>
<tr class="even">
<td>block.gaslimit (uint)</td>
<td>å½“å‰åŒºå—çš„gaslimit</td>
</tr>
<tr class="odd">
<td>block.number (uint)</td>
<td>å½“å‰åŒºå—çš„number</td>
</tr>
<tr class="even">
<td>block.timestamp (uint)</td>
<td>å½“å‰åŒºå—çš„æ—¶é—´æˆ³ï¼Œä¸ºunixçºªå…ƒä»¥æ¥çš„ç§’</td>
</tr>
<tr class="odd">
<td>gasleft() returns (uint256)</td>
<td>å‰©ä½™ gas</td>
</tr>
<tr class="even">
<td>msg.data (bytes calldata)</td>
<td>å®Œæˆ calldata</td>
</tr>
<tr class="odd">
<td>msg.sender (address payable)</td>
<td>æ¶ˆæ¯å‘é€è€… (å½“å‰ caller)</td>
</tr>
<tr class="even">
<td>msg.sig (bytes4)</td>
<td>calldataçš„å‰å››ä¸ªå­—èŠ‚ (function identifier)</td>
</tr>
<tr class="odd">
<td>msg.value (uint)</td>
<td>å½“å‰æ¶ˆæ¯çš„weiå€¼</td>
</tr>
<tr class="even">
<td>now (uint)</td>
<td>å½“å‰å—çš„æ—¶é—´æˆ³</td>
</tr>
<tr class="odd">
<td>tx.gasprice (uint)</td>
<td>äº¤æ˜“çš„gasä»·æ ¼</td>
</tr>
<tr class="even">
<td>tx.origin (address payable)</td>
<td>äº¤æ˜“çš„å‘é€æ–¹</td>
</tr>
</tbody>
</table>
<p><strong>å˜é‡ä½œç”¨åŸŸ</strong></p>
<ul>
<li><strong>Public</strong>Â â€“
å…¬å…±çŠ¶æ€å˜é‡å¯ä»¥åœ¨å†…éƒ¨è®¿é—®ï¼Œä¹Ÿå¯ä»¥é€šè¿‡æ¶ˆæ¯è®¿é—®ã€‚å¯¹äºå…¬å…±çŠ¶æ€å˜é‡ï¼Œå°†ç”Ÿæˆä¸€ä¸ªè‡ªåŠ¨getterå‡½æ•°ã€‚</li>
<li><strong>Internal</strong>Â â€“
å†…éƒ¨çŠ¶æ€å˜é‡åªèƒ½ä»å½“å‰åˆçº¦æˆ–å…¶æ´¾ç”Ÿåˆçº¦å†…è®¿é—®ã€‚</li>
<li><strong>Private</strong>Â â€“
ç§æœ‰çŠ¶æ€å˜é‡åªèƒ½ä»å½“å‰åˆçº¦å†…éƒ¨è®¿é—®ï¼Œæ´¾ç”Ÿåˆçº¦å†…ä¸èƒ½è®¿é—®ã€‚</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^0.5.0;</span><br><span class="line"></span><br><span class="line">contract C &#123;</span><br><span class="line">   uint public data = 30;</span><br><span class="line">   uint internal iData= 10;</span><br><span class="line"></span><br><span class="line">   function x() public returns (uint) &#123;</span><br><span class="line">      data = 3; // å†…éƒ¨è®¿é—®</span><br><span class="line">      return data;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line">contract Caller &#123;</span><br><span class="line">   C c = new C();</span><br><span class="line">   function f() public view returns (uint) &#123;</span><br><span class="line">      return c.data(); // å¤–éƒ¨è®¿é—®</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line">contract D is C &#123;</span><br><span class="line">   uint storedData; // çŠ¶æ€å˜é‡</span><br><span class="line"></span><br><span class="line">   function y() public returns (uint) &#123;</span><br><span class="line">      iData = 3; // æ´¾ç”Ÿåˆçº¦å†…éƒ¨è®¿é—®</span><br><span class="line">      return iData;</span><br><span class="line">   &#125;</span><br><span class="line">   function getResult() public view returns(uint)&#123;</span><br><span class="line">      uint a = 1; // å±€éƒ¨å˜é‡</span><br><span class="line">      uint b = 2;</span><br><span class="line">      uint result = a + b;</span><br><span class="line">      return storedData; // è®¿é—®çŠ¶æ€å˜é‡</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>æ¡ä»¶è¿ç®—ç¬¦</strong></p>
<p><code>?:</code>ï¼šå¦‚æœæ¡ä»¶ä¸ºçœŸï¼Ÿåˆ™å–å€¼Xï¼šå¦åˆ™å€¼Y</p>
<aside>
<p>ğŸ’¡ example:<code>a &gt; b? a: b</code></p>
</aside>
<p><strong>å¾ªç¯è¯­å¥</strong></p>
<p>ä¸cç±»ä¼¼</p>
<p><strong>æ¡ä»¶è¯­å¥</strong></p>
<p>ä¸cç±»ä¼¼</p>
<p><strong>å¼•ç”¨ç±»å‹/å¤åˆæ•°æ®ç±»å‹</strong></p>
<ul>
<li>æ•°ç»„(å­—ç¬¦ä¸²ä¸bytesæ˜¯ç‰¹æ®Šçš„æ•°ç»„ï¼Œæ‰€ä»¥ä¹Ÿæ˜¯å¼•ç”¨ç±»å‹)</li>
<li>structï¼ˆç»“æ„ä½“ï¼‰</li>
<li>mapï¼ˆæ˜ å°„ï¼‰</li>
</ul>
<p>è¿™äº›ç±»å‹æ¶‰åŠåˆ°çš„æ•°æ®é‡è¾ƒå¤§ï¼Œå¤åˆ¶å®ƒä»¬å¯èƒ½è¦æ¶ˆè€—å¤§é‡Gasï¼Œéå¸¸æ˜‚è´µï¼Œæ‰€ä»¥ä½¿ç”¨å®ƒä»¬æ—¶ï¼Œå¿…é¡»è€ƒè™‘å­˜å‚¨ä½ç½®ï¼Œä¾‹å¦‚ï¼Œæ˜¯ä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œè¿˜æ˜¯åœ¨EVMå­˜å‚¨åŒºä¸­</p>
<p><strong>æ•°æ®ä½ç½®</strong></p>
<p><code>Storageï¼ˆå­˜å‚¨ï¼‰</code>ï¼š</p>
<p>å­˜å‚¨æ°¸ä¹…æ•°æ®ï¼Œè¯¥æ•°æ®å¯ä»¥è¢«åˆçº¦ä¸­æ‰€æœ‰å‡½æ•°è®¿é—®ã€‚å¯ä»¥æŠŠå®ƒè§†ä¸ºç¡¬ç›˜æ•°æ®ï¼Œæ‰€æœ‰æ•°æ®éƒ½æ°¸ä¹…å­˜å‚¨ã€‚å› å…¶æ•°æ®å­˜å‚¨çš„æŒä¹…æ€§ï¼Œæ•…æˆæœ¬è¾ƒé«˜</p>
<p><code>Memoryï¼ˆå†…å­˜ï¼‰</code>ï¼š</p>
<p>ä¸´æ—¶æ•°æ®ï¼Œæ¯”Storageä¾¿å®œã€‚å®ƒåªèƒ½åœ¨å‡½æ•°ä¸­è®¿é—®ï¼Œå‡½æ•°æ‰§è¡Œå®Œæ¯•ï¼Œå®ƒçš„å†…å®¹å°±ä¼šè¢«ä¸¢å¼ƒ</p>
<p><code>Calldata</code>ï¼š</p>
<p>ä¸å¯ä¿®æ”¹çš„éæŒä¹…æ€§æ•°æ®ä½ç½®ï¼Œæ‰€æœ‰ä¼ é€’ç»™å‡½æ•°çš„å€¼ï¼Œéƒ½å­˜å‚¨åœ¨è¿™é‡Œã€‚Calladataä¹Ÿæ˜¯å¤–éƒ¨å‡½æ•°çš„å‚æ•°çš„é»˜è®¤ä½ç½®</p>
<p><code>Stackï¼ˆå †æ ˆï¼‰</code>ï¼š</p>
<p>EVMç»´æŠ¤çš„éæŒä¹…æ€§æ•°æ®ï¼ŒEVMä½¿ç”¨å †æ ˆæ•°æ®ä½ç½®åœ¨æ‰§è¡ŒæœŸé—´åŠ è½½å˜é‡ã€‚æœ€å¤šæœ‰1024ä¸ªçº§åˆ«çš„é™åˆ¶</p>
<aside>
<p>ğŸ’¡ æ˜¾ç¤ºæ ‡è®°å˜é‡çš„ä½ç½®ï¼š<code>æ•°æ®ç±»å‹ æ•°æ®ä½ç½® å˜é‡å</code></p>
</aside>
<p><strong>å˜é‡æ•°æ®ä½ç½®è§„åˆ™</strong></p>
<ul>
<li>çŠ¶æ€å˜é‡ï¼šå­˜å‚¨åœ¨å­˜å‚¨åŒºä¸­ã€‚æ­¤å¤–ï¼Œä¸èƒ½æ˜¾å¼æ ‡è®°çŠ¶æ€å˜é‡çš„ä½ç½®</li>
<li>å‡½æ•°å‚æ•°ä¸è¿”å›å€¼ï¼šå­˜å‚¨åœ¨å†…å­˜ä¸­</li>
<li>å±€éƒ¨å˜é‡ï¼šå€¼ç±»å‹å­˜å‚¨åœ¨å†…å­˜ä¸­<code>å¦‚uint,bool,address</code>ï¼Œå¼•ç”¨ç±»å‹<code>æ•°ç»„ï¼Œstructï¼Œmap</code>éœ€è¦æ˜¾å¼åœ°æŒ‡å®šæ•°æ®ä½ç½®</li>
<li>å¤–éƒ¨å‡½æ•°çš„å‚æ•°ï¼šå­˜å‚¨åœ¨Calldataä¸­</li>
</ul>
<p><strong>æšä¸¾ï¼ˆEnumï¼‰</strong></p>
<p>æšä¸¾å°†ä¸€ä¸ªå˜é‡çš„å–å€¼é™åˆ¶ä¸ºå‡ ä¸ªé¢„å®šä¹‰å€¼ä¸­çš„ä¸€ä¸ªã€‚ç²¾ç¡®ä½¿ç”¨æšä¸¾ç±»å‹æœ‰åŠ©äºå‡å°‘ä»£ç ä¸­çš„bug</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">//SPDX-License-Identifier: GPL-3.0</span><br><span class="line"></span><br><span class="line">pragma solidity ^0.8.0;</span><br><span class="line"></span><br><span class="line">contract test &#123;</span><br><span class="line">   enum FreshJuiceSize&#123; SMALL, MEDIUM, LARGE &#125;</span><br><span class="line">   FreshJuiceSize choice;</span><br><span class="line">   FreshJuiceSize constant defaultChoice = FreshJuiceSize.MEDIUM;</span><br><span class="line"></span><br><span class="line">   function setLarge() public &#123;</span><br><span class="line">      choice = FreshJuiceSize.LARGE;</span><br><span class="line">   &#125;</span><br><span class="line">   function getChoice() public view returns (FreshJuiceSize) &#123;</span><br><span class="line">      return choice;</span><br><span class="line">   &#125;</span><br><span class="line">   function getDefaultChoice() public pure returns (uint) &#123;</span><br><span class="line">      return uint(defaultChoice);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>ç»“æ„ä½“ï¼ˆStructï¼‰</strong></p>
<p>ä¸Cç±»ä¼¼</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">//SPDX-License-Identifier: GPL-3.0</span><br><span class="line">pragma solidity ^0.5.0;</span><br><span class="line"></span><br><span class="line">contract test &#123;</span><br><span class="line">   struct Book &#123; </span><br><span class="line">      string title;</span><br><span class="line">      string author;</span><br><span class="line">      uint book_id;</span><br><span class="line">   &#125;</span><br><span class="line">   Book book;</span><br><span class="line"></span><br><span class="line">   function setBook() public &#123;</span><br><span class="line">      book = Book(&#x27;Learn Java&#x27;, &#x27;TP&#x27;, 1);</span><br><span class="line">   &#125;</span><br><span class="line">   function getBookId() public view returns (uint) &#123;</span><br><span class="line">      return book.book_id;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>æ˜ å°„ï¼ˆmappingï¼‰</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mapping(_KeyType =&gt; _ValueType)</span><br></pre></td></tr></table></figure>
<ul>
<li><code>_KeyType</code>Â ï¼šå¯ä»¥æ˜¯ä»»ä½•å†…ç½®ç±»å‹ï¼Œæˆ–è€…byteså’Œå­—ç¬¦ä¸²ã€‚ä¸å…è®¸ä½¿ç”¨å¼•ç”¨ç±»å‹æˆ–å¤æ‚å¯¹è±¡</li>
<li><code>_ValueType</code>Â ï¼š å¯ä»¥æ˜¯ä»»ä½•ç±»å‹</li>
</ul>
<p>æ³¨æ„</p>
<ul>
<li>æ˜ å°„çš„æ•°æ®ä½ç½®(data location)åªèƒ½æ˜¯storageï¼Œé€šå¸¸ç”¨äºçŠ¶æ€å˜é‡</li>
<li>æ˜ å°„å¯ä»¥æ ‡è®°ä¸ºpublicï¼ŒSolidity è‡ªåŠ¨ä¸ºå®ƒåˆ›å»ºgetter</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^0.5.0;</span><br><span class="line"></span><br><span class="line">contract LedgerBalance &#123;</span><br><span class="line">   mapping(address =&gt; uint) public balances;</span><br><span class="line"></span><br><span class="line">   function updateBalance(uint newBalance) public &#123;</span><br><span class="line">      balances[msg.sender] = newBalance;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line">contract Updater &#123;</span><br><span class="line">   function updateBalance() public returns (uint) &#123;</span><br><span class="line">      LedgerBalance ledgerBalance = new LedgerBalance();</span><br><span class="line">      ledgerBalance.updateBalance(10);</span><br><span class="line">      return ledgerBalance.balances(address(this));</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¯¹ç¤ºä¾‹ä»£ç å†™ä¸€ç‚¹è‡ªå·±çš„ç†è§£ï¼š</p>
<p>addressæ˜¯ä¸å¯è¢«è¿ç®—çš„æ•°æ®ç±»å‹ï¼Œå› æ­¤éœ€è¦mapæ˜ å°„ä¸ºuintï¼Œå†å‚ä¸è¿ç®—</p>
<p><strong>ç±»å‹è½¬æ¢</strong></p>
<p>å¯ä»¥ä½¿ç”¨æ„é€ å‡½æ•°è¯­æ³•ï¼Œæ˜¾å¼åœ°å°†æ•°æ®ç±»å‹è½¬æ¢ä¸ºå¦ä¸€ç§ç±»å‹ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">int8 y = -3;</span><br><span class="line">uint x = uint(y);</span><br><span class="line">//Now x = 0xfffff..fd == åœ¨256bité•¿åº¦çš„æ ¼å¼ä¸‹ï¼Œ-3çš„è¡¥ç è¡¨ç¤º</span><br></pre></td></tr></table></figure>
<p>è½¬æ¢æˆæ›´å°çš„ç±»å‹ï¼Œä¼šä¸¢å¤±é«˜ä½ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">uint32 a = 0x12345678;</span><br><span class="line">uint16 b = uint16(a); // b = 0x5678</span><br></pre></td></tr></table></figure>
<p>è½¬æ¢æˆæ›´å¤§çš„ç±»å‹ï¼Œå°†å‘å·¦ä¾§æ·»åŠ å¡«å……ä½ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">uint16 a = 0x1234;</span><br><span class="line">uint32 b = uint32(a); // b = 0x00001234</span><br></pre></td></tr></table></figure>
<p>è½¬æ¢åˆ°æ›´å°çš„å­—èŠ‚ç±»å‹ï¼Œä¼šä¸¢å¤±åé¢æ•°æ®ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">bytes2 a = 0x1234;</span><br><span class="line">bytes1 b = bytes1(a); // b = 0x12</span><br></pre></td></tr></table></figure>
<p>è½¬æ¢ä¸ºæ›´å¤§çš„å­—èŠ‚ç±»å‹æ—¶ï¼Œå‘å³æ·»åŠ å¡«å……ä½ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">bytes2 a = 0x1234;</span><br><span class="line">bytes4 b = bytes4(a); // b = 0x12340000</span><br></pre></td></tr></table></figure>
<p>åªæœ‰å½“å­—èŠ‚ç±»å‹å’Œintç±»å‹å¤§å°ç›¸åŒæ—¶ï¼Œæ‰å¯ä»¥è¿›è¡Œè½¬æ¢ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">bytes2 a = 0x1234;</span><br><span class="line">uint32 b = uint16(a); // b = 0x00001234</span><br><span class="line">uint32 c = uint32(bytes4(a)); // c = 0x12340000</span><br><span class="line">uint8 d = uint8(uint16(a)); // d = 0x34</span><br><span class="line">uint8 e = uint8(bytes1(a)); // e = 0x12</span><br></pre></td></tr></table></figure>
<p>æŠŠæ•´æ•°èµ‹å€¼ç»™æ•´å‹æ—¶ï¼Œä¸èƒ½è¶…å‡ºèŒƒå›´ï¼Œå‘ç”Ÿæˆªæ–­ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">uint8 a = 12; // no error</span><br><span class="line">uint32 b = 1234; // no error</span><br><span class="line">uint16 c = 0x123456; // error, æœ‰æˆªæ–­ï¼Œå˜ä¸º 0x3456</span><br></pre></td></tr></table></figure>
<p><strong>ä»¥å¤ªå•ä½</strong></p>
<p>Solidity
ä¸­ï¼Œä»¥å¤ªå¸çš„å•ä½å¯ä»¥ä½¿ç”¨<code>wei</code>ã€<code>finney</code>ã€<code>szabo</code>æˆ–<code>ether</code>è¡¨ç¤ºã€‚</p>
<p>æœ€å°çš„å•ä½æ˜¯<code>wei</code>ã€‚<code>1e12</code>è¡¨ç¤º<code>1 x 10^12</code>ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">assert(1 wei == 1);</span><br><span class="line">assert(1 szabo == 1e12);</span><br><span class="line">assert(1 finney == 1e15);</span><br><span class="line">assert(1 ether == 1e18);</span><br></pre></td></tr></table></figure>
<p><strong>å‡½æ•°</strong></p>
<p>è¯­æ³•ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">function function-name(parameter-list) scope returns() &#123;</span><br><span class="line">   //è¯­å¥</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>returnè¯­å¥å¯ä»¥è¿”å›å¤šä¸ªå€¼</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^0.5.0;</span><br><span class="line"></span><br><span class="line">contract Test &#123;</span><br><span class="line">   function getResult() public view returns(uint product, uint sum)&#123;</span><br><span class="line">      uint a = 1; // å±€éƒ¨å˜é‡</span><br><span class="line">      uint b = 2;</span><br><span class="line">      product = a * b; // ä½¿ç”¨è¿”å›å‚æ•°è¿”å›å€¼</span><br><span class="line">      sum = a + b; // ä½¿ç”¨è¿”å›å‚æ•°è¿”å›å€¼</span><br><span class="line"></span><br><span class="line">      // ä¹Ÿå¯ä»¥ä½¿ç”¨returnè¿”å›å¤šä¸ªå€¼</span><br><span class="line">      // return(a*b, a+b);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¿®é¥°ç¬¦ï¼š</p>
<p>å‡½æ•°ä¿®é¥°ç¬¦ç”¨äºä¿®æ”¹å‡½æ•°çš„è¡Œä¸ºã€‚ä¾‹å¦‚ï¼Œå‘å‡½æ•°æ·»åŠ æ¡ä»¶é™åˆ¶ã€‚</p>
<p>ä¿®é¥°ç¬¦å®šä¹‰ä¸­å‡ºç°ç‰¹æ®Šç¬¦å·<code>_</code>
çš„åœ°æ–¹ï¼Œç”¨äºæ’å…¥å‡½æ•°ä½“ã€‚å¦‚æœåœ¨è°ƒç”¨æ­¤å‡½æ•°æ—¶ï¼Œæ»¡è¶³äº†ä¿®é¥°ç¬¦çš„æ¡ä»¶ï¼Œåˆ™æ‰§è¡Œè¯¥å‡½æ•°ï¼Œå¦åˆ™å°†æŠ›å‡ºå¼‚å¸¸ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^0.5.0;</span><br><span class="line"></span><br><span class="line">contract Owner &#123;</span><br><span class="line">   address owner;</span><br><span class="line"></span><br><span class="line">   constructor() public &#123;</span><br><span class="line">      owner = msg.sender;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   // å®šä¹‰ä¿®é¥°ç¬¦ onlyOwner ä¸å¸¦å‚æ•°</span><br><span class="line">   modifier onlyOwner &#123;</span><br><span class="line">      require(msg.sender == owner);</span><br><span class="line">      _;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   // å®šä¹‰ä¿®é¥°ç¬¦ costs å¸¦å‚æ•°</span><br><span class="line">   modifier costs(uint price) &#123;</span><br><span class="line">      if (msg.value &gt;= price) &#123;</span><br><span class="line">         _;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">contract Register is Owner &#123;</span><br><span class="line">   mapping (address =&gt; bool) registeredAddresses;</span><br><span class="line">   uint price;</span><br><span class="line"></span><br><span class="line">   constructor(uint initialPrice) public &#123; price = initialPrice; &#125;</span><br><span class="line"></span><br><span class="line">   // ä½¿ç”¨ä¿®é¥°ç¬¦ costs</span><br><span class="line">   function register() public payable costs(price) &#123;</span><br><span class="line">      registeredAddresses[msg.sender] = true;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   // ä½¿ç”¨ä¿®é¥°ç¬¦ onlyOwner</span><br><span class="line">   function changePrice(uint _price) public onlyOwner &#123;</span><br><span class="line">      price = _price;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­<code>onlyOwner</code>å’Œ<code>costs</code>æ˜¯ä¿®é¥°ç¬¦</p>
<p>view(è§†å›¾)å‡½æ•°ï¼š</p>
<p>View(è§†å›¾)å‡½æ•°ä¸ä¼šä¿®æ”¹çŠ¶æ€ã€‚å¦‚æœå‡½æ•°ä¸­å­˜åœ¨ä»¥ä¸‹è¯­å¥ï¼Œåˆ™è¢«è§†ä¸ºä¿®æ”¹çŠ¶æ€ï¼Œç¼–è¯‘å™¨å°†æŠ›å‡ºè­¦å‘Šã€‚</p>
<ul>
<li>ä¿®æ”¹çŠ¶æ€å˜é‡ã€‚</li>
<li>è§¦å‘äº‹ä»¶ã€‚</li>
<li>åˆ›å»ºåˆçº¦ã€‚</li>
<li>ä½¿ç”¨<code>selfdestruct</code>ã€‚</li>
<li>å‘é€ä»¥å¤ªã€‚</li>
<li>è°ƒç”¨ä»»ä½•ä¸æ˜¯è§†å›¾å‡½æ•°æˆ–çº¯å‡½æ•°çš„å‡½æ•°</li>
<li>ä½¿ç”¨åº•å±‚è°ƒç”¨</li>
<li>ä½¿ç”¨åŒ…å«æŸäº›æ“ä½œç çš„å†…è”ç¨‹åºé›†ã€‚</li>
</ul>
<p>Getteræ–¹æ³•æ˜¯é»˜è®¤çš„è§†å›¾å‡½æ•°ã€‚å£°æ˜è§†å›¾å‡½æ•°ï¼Œå¯ä»¥åœ¨å‡½æ•°å£°æ˜é‡Œï¼Œæ·»åŠ <code>view</code>å…³é”®å­—ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^0.5.0;</span><br><span class="line"></span><br><span class="line">contract Test &#123;</span><br><span class="line">   function getResult() public view returns(uint product, uint sum)&#123;</span><br><span class="line">      uint a = 1; // å±€éƒ¨å˜é‡</span><br><span class="line">      uint b = 2;</span><br><span class="line">      product = a * b;</span><br><span class="line">      sum = a + b; </span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>pure(çº¯)å‡½æ•°ï¼š</p>
<p>Pure(çº¯)å‡½æ•°<strong>ä¸è¯»å–</strong>æˆ–ä¿®æ”¹çŠ¶æ€ã€‚å¦‚æœå‡½æ•°ä¸­å­˜åœ¨ä»¥ä¸‹è¯­å¥ï¼Œåˆ™è¢«è§†ä¸ºè¯»å–çŠ¶æ€ï¼Œç¼–è¯‘å™¨å°†æŠ›å‡ºè­¦å‘Šã€‚</p>
<ul>
<li>è¯»å–çŠ¶æ€å˜é‡ã€‚</li>
<li>è®¿é—®Â <code>address(this).balance</code>Â æˆ–Â <code>&lt;address&gt;.balance</code></li>
<li>è®¿é—®ä»»ä½•åŒºå—ã€äº¤æ˜“ã€msgç­‰ç‰¹æ®Šå˜é‡(msg.sig ä¸ msg.data
å…è®¸è¯»å–)ã€‚</li>
<li>è°ƒç”¨ä»»ä½•ä¸æ˜¯çº¯å‡½æ•°çš„å‡½æ•°ã€‚</li>
<li>ä½¿ç”¨åŒ…å«ç‰¹å®šæ“ä½œç çš„å†…è”ç¨‹åºé›†ã€‚</li>
</ul>
<p>å¦‚æœå‘ç”Ÿé”™è¯¯ï¼Œçº¯å‡½æ•°å¯ä»¥ä½¿ç”¨<code>revert()</code>å’Œ<code>require()</code>å‡½æ•°æ¥è¿˜åŸæ½œåœ¨çš„çŠ¶æ€æ›´æ”¹ã€‚</p>
<p>å£°æ˜çº¯å‡½æ•°ï¼Œå¯ä»¥åœ¨å‡½æ•°å£°æ˜é‡Œï¼Œæ·»åŠ <code>pure</code>å…³é”®å­—ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^0.5.0;</span><br><span class="line"></span><br><span class="line">contract Test &#123;</span><br><span class="line">   function getResult() public pure returns(uint product, uint sum)&#123;</span><br><span class="line">      uint a = 1; </span><br><span class="line">      uint b = 2;</span><br><span class="line">      product = a * b;</span><br><span class="line">      sum = a + b; </span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>fallback(å›é€€)å‡½æ•°ï¼š</p>
<p>fallback(å›é€€) å‡½æ•°æ˜¯åˆçº¦ä¸­çš„ç‰¹æ®Šå‡½æ•°ã€‚å®ƒæœ‰ä»¥ä¸‹ç‰¹ç‚¹</p>
<ul>
<li>å½“åˆçº¦ä¸­ä¸å­˜åœ¨çš„å‡½æ•°è¢«è°ƒç”¨æ—¶ï¼Œå°†è°ƒç”¨fallbackå‡½æ•°ã€‚</li>
<li>è¢«æ ‡è®°ä¸ºå¤–éƒ¨å‡½æ•°ã€‚</li>
<li>å®ƒæ²¡æœ‰åå­—ã€‚</li>
<li>å®ƒæ²¡æœ‰å‚æ•°ã€‚</li>
<li>å®ƒä¸èƒ½è¿”å›ä»»ä½•ä¸œè¥¿ã€‚</li>
<li>æ¯ä¸ªåˆçº¦å®šä¹‰ä¸€ä¸ªfallbackå‡½æ•°ã€‚</li>
<li>å¦‚æœæ²¡æœ‰è¢«æ ‡è®°ä¸º<code>payable</code>ï¼Œåˆ™å½“åˆçº¦æ”¶åˆ°æ— æ•°æ®çš„ä»¥å¤ªå¸è½¬è´¦æ—¶ï¼Œå°†æŠ›å‡ºå¼‚å¸¸ã€‚</li>
</ul>
<p>è¯­æ³•</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// æ²¡æœ‰åå­—ï¼Œæ²¡æœ‰å‚æ•°ï¼Œä¸è¿”å›ï¼Œæ ‡è®°ä¸ºexternalï¼Œå¯ä»¥æ ‡è®°ä¸ºpayable</span><br><span class="line">function() external &#123;</span><br><span class="line">    // statements</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸‹é¢çš„ç¤ºä¾‹å±•ç¤ºäº†åˆçº¦ä¸­çš„å›é€€å‡½æ•°æ¦‚å¿µã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^0.5.0;</span><br><span class="line"></span><br><span class="line">contract Test &#123;</span><br><span class="line">   uint public x ;</span><br><span class="line">   function() external &#123; x = 1; &#125;    </span><br><span class="line">&#125;</span><br><span class="line">contract Sink &#123;</span><br><span class="line">   function() external payable &#123; &#125;</span><br><span class="line">&#125;</span><br><span class="line">contract Caller &#123;</span><br><span class="line"></span><br><span class="line">   function callTest(Test test) public returns (bool) &#123;</span><br><span class="line">      (bool success,) = address(test).call(abi.encodeWithSignature(&quot;nonExistingFunction()&quot;));</span><br><span class="line">      require(success);</span><br><span class="line">      // test.x æ˜¯ 1</span><br><span class="line"></span><br><span class="line">      address payable testPayable = address(uint160(address(test)));</span><br><span class="line"></span><br><span class="line">      // å‘é€ä»¥å¤ªæµ‹è¯•åˆåŒ,</span><br><span class="line">      // è½¬è´¦å°†å¤±è´¥ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™é‡Œè¿”å›falseã€‚</span><br><span class="line">      return (testPayable.send(2 ether));</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   function callSink(Sink sink) public returns (bool) &#123;</span><br><span class="line">      address payable sinkPayable = address(sink);</span><br><span class="line">      return (sinkPayable.send(2 ether));</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>å‡½æ•°é‡è½½</strong></p>
<p>åŒä¸€ä¸ªä½œç”¨åŸŸå†…ï¼Œç›¸åŒå‡½æ•°åå¯ä»¥å®šä¹‰å¤šä¸ªå‡½æ•°ã€‚è¿™äº›å‡½æ•°çš„å‚æ•°(å‚æ•°ç±»å‹æˆ–å‚æ•°æ•°é‡)å¿…é¡»ä¸ä¸€æ ·ã€‚ä»…ä»…æ˜¯è¿”å›å€¼ä¸ä¸€æ ·ä¸è¢«å…è®¸</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^0.5.0;</span><br><span class="line"></span><br><span class="line">contract Test &#123;</span><br><span class="line">   function getSum(uint a, uint b) public pure returns(uint)&#123;      </span><br><span class="line">      return a + b;</span><br><span class="line">   &#125;</span><br><span class="line">   function getSum(uint a, uint b, uint c) public pure returns(uint)&#123;      </span><br><span class="line">      return a + b + c;</span><br><span class="line">   &#125;</span><br><span class="line">   function callSumWithTwoArguments() public pure returns(uint)&#123;</span><br><span class="line">      return getSum(1,2);</span><br><span class="line">   &#125;</span><br><span class="line">   function callSumWithThreeArguments() public pure returns(uint)&#123;</span><br><span class="line">      return getSum(1,2,3);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//0: uint256: 3</span><br><span class="line">//0: uint256: 6</span><br></pre></td></tr></table></figure>
<p><strong>æ•°å­¦å‡½æ•°</strong></p>
<p>Solidityæä¾›å†…ç½®çš„æ•°å­¦å‡½æ•°ï¼Œå¦‚ï¼š</p>
<ul>
<li><code>addmod(uint x, uint y, uint k) returns (uint)</code>Â è®¡ç®—(x +
y) % kï¼Œè®¡ç®—ä¸­ï¼Œä»¥ä»»æ„ç²¾åº¦æ‰§è¡ŒåŠ æ³•ï¼Œä¸”ä¸é™äº2^256å¤§å°ã€‚</li>
<li><code>mulmod(uint x, uint y, uint k) returns (uint)</code>Â è®¡ç®—(x *
y) % kï¼Œè®¡ç®—ä¸­ï¼Œä»¥ä»»æ„ç²¾åº¦æ‰§è¡Œä¹˜æ³•ï¼Œä¸”ä¸é™äº2^256å¤§å°ã€‚</li>
</ul>
<p><strong>åŠ å¯†å‡½æ•°</strong></p>
<p>Solidity æä¾›äº†å¸¸ç”¨çš„åŠ å¯†å‡½æ•°ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›é‡è¦å‡½æ•°ï¼š</p>
<ul>
<li><code>keccak256(bytes memory) returns (bytes32)</code>Â è®¡ç®—è¾“å…¥çš„Keccak-256æ•£åˆ—ã€‚</li>
<li><code>sha256(bytes memory) returns (bytes32)</code>Â è®¡ç®—è¾“å…¥çš„SHA-256æ•£åˆ—ã€‚</li>
<li><code>ripemd160(bytes memory) returns (bytes20)</code>Â è®¡ç®—è¾“å…¥çš„RIPEMD-160æ•£åˆ—ã€‚</li>
<li><code>ecrecover(bytes32 hash, uint8 v, bytes32 r, bytes32 s) returns (address)</code>Â ä»æ¤­åœ†æ›²çº¿ç­¾åä¸­æ¢å¤ä¸å…¬é’¥ç›¸å…³çš„åœ°å€ï¼Œæˆ–åœ¨å‡ºé”™æ—¶è¿”å›é›¶ã€‚å‡½æ•°å‚æ•°å¯¹åº”äºç­¾åçš„ECDSAå€¼:
r â€“ ç­¾åçš„å‰32å­—èŠ‚; s: ç­¾åçš„ç¬¬äºŒä¸ª32å­—èŠ‚; v:
ç­¾åçš„æœ€åä¸€ä¸ªå­—èŠ‚ã€‚è¿™ä¸ªæ–¹æ³•è¿”å›ä¸€ä¸ªåœ°å€ã€‚</li>
</ul>
<p><strong>åˆçº¦ç»§æ‰¿</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^0.8.0;</span><br><span class="line"></span><br><span class="line">contract A &#123;</span><br><span class="line">   ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">contract B is A &#123;</span><br><span class="line">   ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>æ„é€ å‡½æ•°</strong></p>
<p>æ„é€ å‡½æ•°æ˜¯ä½¿ç”¨<code>construct</code>å…³é”®å­—å£°æ˜çš„ç‰¹æ®Šå‡½æ•°ï¼Œç”¨äºåˆå§‹åŒ–åˆçº¦çš„çŠ¶æ€å˜é‡ã€‚åˆçº¦ä¸­æ„é€ å‡½æ•°æ˜¯å¯é€‰çš„ï¼Œå¯ä»¥çœç•¥ã€‚</p>
<p>æ„é€ å‡½æ•°æœ‰ä»¥ä¸‹é‡è¦ç‰¹æ€§ï¼š</p>
<ul>
<li>ä¸€ä¸ªåˆçº¦åªèƒ½æœ‰ä¸€ä¸ªæ„é€ å‡½æ•°ã€‚</li>
<li>æ„é€ å‡½æ•°åœ¨åˆ›å»ºåˆçº¦æ—¶æ‰§è¡Œä¸€æ¬¡ï¼Œç”¨äºåˆå§‹åŒ–åˆçº¦çŠ¶æ€ã€‚</li>
<li>åœ¨æ‰§è¡Œæ„é€ å‡½æ•°ä¹‹åï¼Œåˆçº¦æœ€ç»ˆä»£ç è¢«éƒ¨ç½²åˆ°åŒºå—é“¾ã€‚åˆçº¦æœ€ç»ˆä»£ç åŒ…æ‹¬å…¬å…±å‡½æ•°å’Œå¯é€šè¿‡å…¬å…±å‡½æ•°è®¿é—®çš„ä»£ç ã€‚æ„é€ å‡½æ•°ä»£ç æˆ–ä»…ç”±æ„é€ å‡½æ•°ä½¿ç”¨çš„ä»»ä½•å†…éƒ¨æ–¹æ³•ä¸åŒ…æ‹¬åœ¨æœ€ç»ˆä»£ç ä¸­ã€‚</li>
<li>æ„é€ å‡½æ•°å¯ä»¥æ˜¯å…¬å…±çš„ï¼Œä¹Ÿå¯ä»¥æ˜¯å†…éƒ¨çš„ã€‚</li>
<li>å†…éƒ¨æ„é€ å‡½æ•°å°†åˆçº¦æ ‡è®°ä¸ºæŠ½è±¡åˆçº¦ã€‚</li>
<li>å¦‚æœæ²¡æœ‰å®šä¹‰æ„é€ å‡½æ•°ï¼Œåˆ™ä½¿ç”¨é»˜è®¤æ„é€ å‡½æ•°ã€‚</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^0.5.0;</span><br><span class="line"></span><br><span class="line">contract Test &#123;</span><br><span class="line">   constructor() public &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>å¦‚æœåŸºåˆçº¦å…·æœ‰å¸¦å‚æ•°çš„æ„é€ å‡½æ•°ï¼Œåˆ™æ¯ä¸ªæ´¾ç”Ÿ/ç»§æ‰¿çš„åˆçº¦ä¹Ÿéƒ½å¿…é¡»åŒ…å«å‚æ•°ã€‚</li>
<li>å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„æ–¹æ³•ç›´æ¥åˆå§‹åŒ–åŸºæ„é€ å‡½æ•°</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^0.5.0;</span><br><span class="line"></span><br><span class="line">contract Base &#123;</span><br><span class="line">   uint data;</span><br><span class="line">   constructor(uint _data) public &#123;</span><br><span class="line">      data = _data;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line">contract Derived is Base (5) &#123;</span><br><span class="line">   constructor() public &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•é—´æ¥åˆå§‹åŒ–åŸºæ„é€ å‡½æ•°</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^0.5.0;</span><br><span class="line"></span><br><span class="line">contract Base &#123;</span><br><span class="line">   uint data;</span><br><span class="line">   constructor(uint _data) public &#123;</span><br><span class="line">      data = _data;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line">contract Derived is Base &#123;</span><br><span class="line">   constructor(uint _info) Base(_info * _info) public &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>ä¸å…è®¸ç›´æ¥æˆ–é—´æ¥åœ°åˆå§‹åŒ–åŸºåˆçº¦æ„é€ å‡½æ•°ã€‚</li>
<li>å¦‚æœæ´¾ç”Ÿåˆçº¦æ²¡æœ‰å°†å‚æ•°ä¼ é€’ç»™åŸºåˆçº¦æ„é€ å‡½æ•°ï¼Œåˆ™æ´¾ç”Ÿåˆçº¦å°†æˆä¸ºæŠ½è±¡åˆçº¦ã€‚</li>
</ul>
<p><strong>æŠ½è±¡åˆçº¦</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^0.5.0;</span><br><span class="line"></span><br><span class="line">contract Calculator &#123;</span><br><span class="line">   function getResult() public view returns(uint);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">contract Test is Calculator &#123;</span><br><span class="line">   function getResult() public view returns(uint) &#123;</span><br><span class="line">      uint a = 1;</span><br><span class="line">      uint b = 2;</span><br><span class="line">      uint result = a + b;</span><br><span class="line">      return result;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>æ¥å£</strong></p>
<p>æ¥å£ç±»ä¼¼äºæŠ½è±¡åˆçº¦ï¼Œä½¿ç”¨<code>interface</code>å…³é”®å­—åˆ›å»ºï¼Œæ¥å£åªèƒ½åŒ…å«æŠ½è±¡å‡½æ•°ï¼Œä¸èƒ½åŒ…å«å‡½æ•°å®ç°ã€‚ä»¥ä¸‹æ˜¯æ¥å£çš„å…³é”®ç‰¹æ€§ï¼š</p>
<ul>
<li>æ¥å£çš„å‡½æ•°åªèƒ½æ˜¯å¤–éƒ¨ç±»å‹ã€‚</li>
<li>æ¥å£ä¸èƒ½æœ‰æ„é€ å‡½æ•°ã€‚</li>
<li>æ¥å£ä¸èƒ½æœ‰çŠ¶æ€å˜é‡ã€‚</li>
<li>æ¥å£å¯ä»¥åŒ…å«enumã€structå®šä¹‰ï¼Œå¯ä»¥ä½¿ç”¨<code>interface_name.</code>è®¿é—®å®ƒä»¬ã€‚</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^0.5.0;</span><br><span class="line"></span><br><span class="line">interface Calculator &#123;</span><br><span class="line">   function getResult() external view returns(uint);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">contract Test is Calculator &#123;</span><br><span class="line">   constructor() public &#123;&#125;</span><br><span class="line">   function getResult() external view returns(uint)&#123;</span><br><span class="line">      uint a = 1; </span><br><span class="line">      uint b = 2;</span><br><span class="line">      uint result = a + b;</span><br><span class="line">      return result;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>åº“</strong></p>
<p>Solidityä¸­ï¼Œå¯¹åº“çš„ä½¿ç”¨æœ‰ä¸€å®šçš„é™åˆ¶ã€‚ä»¥ä¸‹æ˜¯åº“çš„ä¸»è¦ç‰¹å¾ã€‚</p>
<ul>
<li>å¦‚æœåº“å‡½æ•°ä¸ä¿®æ”¹çŠ¶æ€ï¼Œåˆ™å¯ä»¥ç›´æ¥è°ƒç”¨å®ƒä»¬ã€‚è¿™æ„å‘³ç€<a
target="_blank" rel="noopener" href="https://www.qikegu.com/docs/4963">çº¯å‡½æ•°</a>æˆ–<a
target="_blank" rel="noopener" href="https://www.qikegu.com/docs/4961">è§†å›¾å‡½æ•°</a>åªèƒ½ä»åº“å¤–éƒ¨è°ƒç”¨ã€‚</li>
<li>åº“ä¸èƒ½è¢«é”€æ¯ï¼Œå› ä¸ºå®ƒè¢«è®¤ä¸ºæ˜¯æ— çŠ¶æ€çš„ã€‚</li>
<li>åº“ä¸èƒ½æœ‰çŠ¶æ€å˜é‡ã€‚</li>
<li>åº“ä¸èƒ½ç»§æ‰¿ä»»ä½•å…¶ä»–å…ƒç´ ã€‚</li>
<li>åº“ä¸èƒ½è¢«ç»§æ‰¿ã€‚</li>
</ul>
<p>ä½¿ç”¨libraryå£°æ˜ï¼Œä½¿ç”¨<code>&lt;library_name&gt;.&lt;func_name&gt;</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^0.5.0;</span><br><span class="line"></span><br><span class="line">library Search &#123;</span><br><span class="line">   function indexOf(uint[] storage self, uint value) public view returns (uint) &#123;</span><br><span class="line">      for (uint i = 0; i &lt; self.length; i++) if (self[i] == value) return i;</span><br><span class="line">      return uint(-1);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line">contract Test &#123;</span><br><span class="line">   uint[] data;</span><br><span class="line">   constructor() public &#123;</span><br><span class="line">      data.push(1);</span><br><span class="line">      data.push(2);</span><br><span class="line">      data.push(3);</span><br><span class="line">      data.push(4);</span><br><span class="line">      data.push(5);</span><br><span class="line">   &#125;</span><br><span class="line">   function isValuePresent() external view returns(uint)&#123;</span><br><span class="line">      uint value = 4;</span><br><span class="line"></span><br><span class="line">      // ä½¿ç”¨åº“å‡½æ•°æœç´¢æ•°ç»„ä¸­æ˜¯å¦å­˜åœ¨å€¼</span><br><span class="line">      uint index = Search.indexOf(data, value);</span><br><span class="line">      return index;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>****ä½¿ç”¨æ±‡ç¼–(Assembly)ä»£ç ****</p>
<p>ä½¿ç”¨å†…è”æ±‡ç¼–ï¼Œå¯ä»¥åœ¨solidityä¸­åµŒå…¥æ±‡ç¼–ä»£ç ï¼Œä½¿ç”¨</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">assembly&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>äº‹ä»¶</strong></p>
<p>äº‹ä»¶æ˜¯æ™ºèƒ½åˆçº¦å‘å‡ºçš„ä¿¡å·ã€‚æ™ºèƒ½åˆçº¦çš„å‰ç«¯UIï¼Œä¾‹å¦‚ï¼ŒDAppsã€web.jsï¼Œæˆ–è€…ä»»ä½•ä¸Ethereum
JSON-RPC
APIè¿æ¥çš„ä¸œè¥¿ï¼Œéƒ½å¯ä»¥ä¾¦å¬è¿™äº›äº‹ä»¶ã€‚äº‹ä»¶å¯ä»¥è¢«ç´¢å¼•ï¼Œä»¥ä¾¿ä»¥åå¯ä»¥æœç´¢äº‹ä»¶è®°å½•ã€‚</p>
<blockquote>
<p>äº‹ä»¶åœ¨åŒºå—é“¾ä¸­çš„å­˜å‚¨</p>
<p>åŒºå—é“¾æ˜¯ä¸€ä¸ªåŒºå—é“¾è¡¨ï¼Œè¿™äº›å—çš„å†…å®¹åŸºæœ¬ä¸Šæ˜¯äº¤æ˜“è®°å½•ã€‚æ¯ä¸ªäº¤æ˜“éƒ½æœ‰ä¸€ä¸ªé™„åŠ çš„äº¤æ˜“æ—¥å¿—ï¼Œäº‹ä»¶ç»“æœå­˜æ”¾åœ¨äº¤æ˜“æ—¥å¿—é‡Œã€‚åˆçº¦å‘å‡ºçš„äº‹ä»¶ï¼Œå¯ä»¥ä½¿ç”¨åˆçº¦åœ°å€è®¿é—®ã€‚</p>
</blockquote>
<p>Solidityä¸­å¯ä»¥ä½¿ç”¨<code>event</code>å…³é”®å­—(åœ¨ç”¨æ³•ä¸Šç±»ä¼¼äº<code>function</code>å…³é”®å­—)ã€‚ç„¶åå¯ä»¥åœ¨å‡½æ•°ä¸­ä½¿ç”¨<code>emit</code>å…³é”®å­—è§¦å‘äº‹ä»¶</p>
<p>åˆ›å»ºåˆçº¦å¹¶å‘å‡ºä¸€ä¸ªäº‹ä»¶</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^0.5.0;</span><br><span class="line"></span><br><span class="line">contract Counter &#123;</span><br><span class="line">    uint256 public count = 0;</span><br><span class="line"></span><br><span class="line">    event Increment(address who);   // å£°æ˜äº‹ä»¶</span><br><span class="line"></span><br><span class="line">    function increment() public &#123;</span><br><span class="line">        emit Increment(msg.sender); // è§¦å‘äº‹ä»¶</span><br><span class="line">        count += 1;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div><nav class="pagination"><a id="left-navigator" href="/2023/07/11/AES%E7%9B%B8%E5%85%B3%E5%8A%9F%E8%80%97%E5%88%86%E6%9E%90%E9%97%AE%E9%A2%98/">AESç›¸å…³åŠŸè€—åˆ†æé—®é¢˜</a><a id="right-navigator" href="/2023/02/05/%E8%AE%B0%E4%B8%80%E4%B8%AANTRU%E6%9D%BF%E5%AD%90%E9%A2%98/">è®°ä¸€ä¸ªNTRUæ¿å­é¢˜</a></nav></div><nav id="footer"><ul id="footer-links"><li><a href="/about" class="zn">å…³äº</a></li><li><a href="/archives" class="zn">æ‰€æœ‰æ–‡ç« </a></li></ul></nav></div></body></html>