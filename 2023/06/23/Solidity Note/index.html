<!DOCTYPE html>
<html lang="zh-CN">

  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="keywords" content="" />
  <meta name="author" content="Canzik" />
  <meta name="description" content="ä¸–ç•Œä¸Šåªæœ‰ä¸€ç§çœŸæ­£çš„è‹±é›„ä¸»ä¹‰ï¼Œé‚£å°±æ˜¯åœ¨è®¤æ¸…ç”Ÿæ´»çš„çœŸç›¸åä¾ç„¶çƒ­çˆ±ç”Ÿæ´»ã€‚" />
  
  
  <title>
    
      Solidity Note 
      
      
    
  </title>

  
    <link rel="apple-touch-icon" href="/images/favicon.png">
    <link rel="icon" href="/images/favicon.png">
  

  <!-- Raleway-Font -->
  <link href="https://fonts.googleapis.com/css?family=Montserrat|Roboto:400,400italic,600|Roboto+Mono" rel="stylesheet">

  <!-- hexo site css -->
  
<link rel="stylesheet" href="/css/base.css">
<link rel="stylesheet" href="/css/common.css">
<link rel="stylesheet" href="/iconfont/iconfont.css">


  

  
    
<link rel="stylesheet" href="/css/post.css">

  

  <!-- jquery3.3.1 -->
  <script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>

  <!-- fancybox -->
  <link href="https://cdn.bootcss.com/fancybox/3.5.2/jquery.fancybox.min.css" rel="stylesheet">
  <script async src="https://cdn.bootcss.com/fancybox/3.5.2/jquery.fancybox.min.js"></script>
  
<script src="/js/fancybox.js"></script>


<meta name="generator" content="Hexo 6.0.0"></head>


  <body>
    <div id="app">
      <div class="header">
  <a href="/">Canzik</a>
</div>


      <p class="links">
  
    <a title="archives" target="" href="/archives/">
      <i class="iconfont icon-bookmark"></i>
    </a>
  
    <a title="github" target="_blank" href="https://github.com/Canzik">
      <i class="iconfont icon-github"></i>
    </a>
  
    <a title="email" target="" href="canzikkai@gmail.com">
      <i class="iconfont icon-envelope"></i>
    </a>
  
    <a title="rss" target="_blank" href="/atom.xml">
      <i class="iconfont icon-rss"></i>
    </a>
  
</p>


      <div class="main">
        <!-- æ–‡ç« è¯¦æƒ…é¡µï¼Œå±•ç¤ºæ–‡ç« å…·ä½“å†…å®¹ï¼Œurlå½¢å¼ï¼šhttps://yoursite/æ–‡ç« æ ‡é¢˜/ -->
<!-- åŒæ—¶ä¸ºã€Œæ ‡ç­¾tagã€ï¼Œã€Œæœ‹å‹friendã€ï¼Œã€Œåˆ†ç±»categoriesã€ï¼Œã€Œå…³äºaboutã€é¡µé¢çš„æ‰¿è½½é¡µé¢ï¼Œå…·ä½“å±•ç¤ºå–å†³äºpage.type -->

<!-- LaTex Display -->
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js">
</script>
<script>
  MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']]
    }
  };
</script>

<div class="post">
  <h3 class="date">
    Jun 23, 2023
  </h3>
  <h1>
    Solidity Note
  </h1>
  <div class="content markdown-body">
    <h2 id="ç®€å•çš„æ™ºèƒ½åˆçº¦"><a href="#ç®€å•çš„æ™ºèƒ½åˆçº¦" class="headerlink" title="ç®€å•çš„æ™ºèƒ½åˆçº¦"></a>ç®€å•çš„æ™ºèƒ½åˆçº¦</h2><p>Solidityä¸­æ™ºèƒ½åˆçº¦çš„å«ä¹‰å°±æ˜¯ä¸€ç»„ä»£ç ï¼ˆå®ƒçš„ <em>åŠŸèƒ½</em> )å’Œæ•°æ®ï¼ˆå®ƒçš„ <em>çŠ¶æ€</em>ï¼‰çš„é›†åˆï¼Œå¹¶ä¸”å®ƒä»¬æ˜¯ä½äºä»¥å¤ªåŠåŒºå—é“¾çš„ä¸€ä¸ªç‰¹å®šåœ°å€ä¸Šçš„</p>
<p><strong>å­˜å‚¨åˆçº¦ç¤ºä¾‹</strong></p>
<pre><code class="lang-solidity">// SPDX-License-Identifier: GPL-3.0
pragma solidity &gt;=0.4.16 &lt;0.9.0;  //å£°æ˜ç‰ˆæœ¬èŒƒå›´

contract SimpleStorage &#123;
    uint storedData;  //uint 256ä½æ— ç¬¦å·æ•´æ•°

    function set(uint x) public &#123;
        storedData = x;   //solidityä¸­ä¸éœ€è¦ç”¨this.è®¿é—®
    &#125;

    function get() public view returns (uint) &#123;
        return storedData;
    &#125;
&#125;
</code></pre>
<p><code>set</code>ï¼šä¿®æ”¹å˜é‡storeDataçš„å€¼</p>
<p><code>get</code>ï¼šæ£€ç´¢å˜é‡storeDataçš„å€¼</p>
<p>è¿™ä¸ªç®€å•çš„åˆçº¦å…è®¸ä»»ä½•äººåœ¨åˆçº¦ä¸­å­˜å‚¨ä¸€ä¸ªå•ç‹¬çš„æ•°å­—ï¼Œå¹¶ä¸”è¿™ä¸ªæ•°å­—å¯ä»¥è¢«ä»»ä½•äººè®¿é—®ï¼Œä¸”æ²¡æœ‰å¯è¡Œçš„æ–¹æ³•é˜»æ­¢è¿™ä¸ªæ•°å­—çš„å‘å¸ƒ</p>
<p><strong><strong>è´§å¸åˆçº¦ï¼ˆSubcurrencyï¼‰ç¤ºä¾‹</strong></strong></p>
<pre><code class="lang-solidity">// SPDX-License-Identifier: GPL-3.0pragma solidity ^0.8.4;

contract Coin &#123;
    // å…³é”®å­—â€œpublicâ€è®©è¿™äº›å˜é‡å¯ä»¥ä»å¤–éƒ¨è¯»å–    
    address public minter;
    mapping (address =&gt; uint) public balances;

    // è½»å®¢æˆ·ç«¯å¯ä»¥é€šè¿‡äº‹ä»¶é’ˆå¯¹å˜åŒ–ä½œå‡ºé«˜æ•ˆçš„ååº”    
    event Sent(address from, address to, uint amount);

    // è¿™æ˜¯æ„é€ å‡½æ•°ï¼Œåªæœ‰å½“åˆçº¦åˆ›å»ºæ—¶è¿è¡Œ    
    constructor() &#123;
        minter = msg.sender;
    &#125;

    function mint(address receiver, uint amount) public &#123;
        require(msg.sender == minter);
        balances[receiver] += amount;
    &#125;

   // Errors allow you to provide information about
   // why an operation failed. They are returned
   // to the caller of the function.    
   error InsufficientBalance(uint requested, uint available);

    function send(address receiver, uint amount) public &#123;
        if (amount &gt; balances[msg.sender])
            revert InsufficientBalance(&#123;
                requested: amount,
                available: balances[msg.sender]
            &#125;);

        balances[msg.sender] -= amount;
        balances[receiver] += amount;
        emit Sent(msg.sender, receiver, amount);
    &#125;
&#125;
</code></pre>
<p><code>address public minter</code>ï¼š</p>
<p>addressæ˜¯ä¸ª160ä½çš„å€¼ï¼Œä¸”ä¸å…è®¸ä»»ä½•ç®—æ•°æ“ä½œã€‚å…³é”®å­—<code>public</code>è‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªå‡½æ•°ï¼Œå…è®¸åœ¨æ­¤åˆçº¦ä¹‹å¤–è®¿é—®è¿™ä¸ªçŠ¶æ€å˜é‡çš„å½“å‰å€¼ã€‚publicä¼šç”±ç¼–è¯‘å™¨è‡ªåŠ¨ç”Ÿæˆä¸€æ®µå‡½æ•°ï¼Œä»£ç å¤§è‡´å¦‚ä¸‹ï¼ˆæš‚æ—¶å¿½ç•¥ external å’Œ viewï¼‰ï¼š</p>
<pre><code class="lang-solidity">function minter() external view returns (address) &#123; return minter; &#125;
</code></pre>
<p>åœ¨ä½¿ç”¨publicåå†åŠ ä¸Šè¿™æ®µä»£ç ä¼šé€ æˆå†²çªï¼Œä¼šå‡ºç°åŒåçš„ä¸€ä¸ªå‡½æ•°å’Œä¸€ä¸ªå˜é‡</p>
<p><code>mapping (address =&gt; uint) public balances</code>ï¼š</p>
<p>mappingç±»å‹ï¼Œå°†addressæ˜ å°„ä¸ºæ— ç¬¦å·æ•´æ•°ï¼ˆuintï¼‰ã€‚åœ¨ä½¿ç”¨mappingæ—¶ï¼Œè¦ä¹ˆè®°ä½ä½ æ·»åŠ åˆ°mappingä¸­çš„æ•°æ®ï¼ˆä½¿ç”¨åˆ—è¡¨æˆ–æ›´é«˜çº§çš„æ•°æ®ç±»å‹ä¼šæ›´å¥½ï¼‰ï¼Œè¦ä¹ˆåœ¨ä¸éœ€è¦é”®åˆ—è¡¨æˆ–å€¼åˆ—è¡¨çš„ä¸Šä¸‹æ–‡ä¸­ä½¿ç”¨å®ƒã€‚è¿™é‡Œç”±publicç”Ÿæˆçš„å‡½æ•°è¦æ›´åŠ å¤æ‚ä¸€ç‚¹ï¼Œå¤§è‡´å¦‚ä¸‹ï¼š</p>
<pre><code class="lang-solidity">function balances(address account) external view returns (uint) &#123;
    return balances[account];
&#125;
</code></pre>
<p>å¯ä»¥å¾ˆè½»æ¾çš„æŸ¥è¯¢è´¦æˆ·çš„ä½™é¢</p>
<p><code>event Sent(address from, address to, uint amount)</code>ï¼š</p>
<p>è¿™è¡Œå£°æ˜äº†ä¸€ä¸ªæ‰€è°“çš„â€œäº‹ä»¶ï¼ˆeventï¼‰â€ï¼Œå®ƒä¼šåœ¨ <code>send</code> å‡½æ•°çš„æœ€åä¸€è¡Œè¢«å‘å‡ºã€‚ç”¨æˆ·ç•Œé¢ï¼ˆå½“ç„¶ä¹ŸåŒ…æ‹¬æœåŠ¡å™¨åº”ç”¨ç¨‹åºï¼‰å¯ä»¥ç›‘å¬åŒºå—é“¾ä¸Šæ­£åœ¨å‘é€çš„äº‹ä»¶ï¼Œè€Œä¸ä¼šèŠ±è´¹å¤ªå¤šæˆæœ¬ã€‚ä¸€æ—¦å®ƒè¢«å‘å‡ºï¼Œç›‘å¬è¯¥äº‹ä»¶çš„listeneréƒ½å°†æ”¶åˆ°é€šçŸ¥ã€‚è€Œæ‰€æœ‰çš„äº‹ä»¶éƒ½åŒ…å«äº† <code>from</code> ï¼Œ <code>to</code> å’Œ <code>amount</code> ä¸‰ä¸ªå‚æ•°ï¼Œå¯æ–¹ä¾¿è¿½è¸ªäº¤æ˜“ã€‚</p>
<p>ä¸ºäº†ç›‘å¬è¿™ä¸ªäº‹ä»¶ï¼Œä½ å¯ä»¥ä½¿ç”¨å¦‚ä¸‹JavaScriptä»£ç ï¼Œ Coin æ˜¯é€šè¿‡ web3.js åˆ›å»ºçš„åˆçº¦å¯¹è±¡  :</p>
<pre><code class="lang-jsx">Coin.Sent().watch(&#123;&#125;, &#39;&#39;,function(error, result) &#123;
if (!error) &#123;
        console.log(&quot;Coin transfer: &quot; + result.args.amount +
            &quot; coins were sent from &quot; + result.args.from +
            &quot; to &quot; + result.args.to + &quot;.&quot;);
        console.log(&quot;Balances now:\n&quot; +
            &quot;Sender: &quot; + Coin.balances.call(result.args.from) +
            &quot;Receiver: &quot; + Coin.balances.call(result.args.to));
    &#125;
&#125;)
</code></pre>
<p><del>æä¸æ‡‚eventï¼Œèœçš„æ‰£è„š</del></p>
<p><code>constructor</code>ï¼š</p>
<p>åˆ›å»ºåˆçº¦æœŸé—´è¿è¡Œçš„æ„é€ å‡½æ•°ï¼Œä¸èƒ½åœ¨åˆ›å»ºåè°ƒç”¨ã€‚æ­¤åˆçº¦ä¸­æ„é€ å‡½æ•°ç”¨æ¥æ°¸ä¹…å­˜å‚¨åˆ›å»ºåˆçº¦çš„äººçš„åœ°å€<code>msg</code>ã€‚<code>msg.sender</code>å§‹ç»ˆè®°å½•å½“å‰ï¼ˆå¤–éƒ¨ï¼‰å‡½æ•°è°ƒç”¨æ˜¯æ¥è‡ªäºå“ªä¸€ä¸ªåœ°å€</p>
<p><code>mint</code>ï¼š</p>
<p>mintå‡½æ•°ç”¨æ¥æ–°å‘è¡Œä¸€å®šçš„å¸åˆ°ä¸€ä¸ªæ–°åœ°å€ã€‚<code>require</code>ç”¨æ¥æ£€æŸ¥æŸäº›æ¡ä»¶ï¼Œä¸æ»¡è¶³å°±ä¼šå›æ¨æ‰€æœ‰çš„çŠ¶æ€å˜åŒ–ã€‚åœ¨è¿™ä¸ªåˆçº¦ä¸­ï¼Œ<code>require(msg.sender == minter)</code>ç¡®ä¿åªæœ‰åˆçº¦åˆ›å»ºè€…å¯ä»¥è°ƒç”¨<code>mint</code>ã€‚å½“<code>balances[receiver] += amount</code>çš„å€¼å¤§äº<code>uint</code>ï¼ˆ2**256-1ï¼‰ï¼Œç§°ä¸ºæº¢å‡ºäº¤æ˜“ï¼Œæº¢å‡ºäº¤æ˜“å°†è¢«è¿˜åŸ</p>
<p><code>error</code>ï¼š</p>
<p>æè¿°é”™è¯¯ä¿¡æ¯ï¼Œä¸€èˆ¬å’Œ<code>revert</code>ä¸€èµ·ä½¿ç”¨ã€‚<code>revert</code>è¯­å¥æ— æ¡ä»¶åœ°ä¸­æ­¢æ‰§è¡Œå¹¶å›é€€æ‰€æœ‰çš„å˜åŒ–ï¼Œç±»ä¼¼äº <code>require</code>å‡½æ•°ï¼Œå®ƒä¹ŸåŒæ ·å…è®¸ä½ æä¾›ä¸€ä¸ªé”™è¯¯çš„åç§°å’Œé¢å¤–çš„æ•°æ®ï¼Œè¿™äº›é¢å¤–æ•°æ®å°†æä¾›ç»™è°ƒç”¨è€…(å¹¶æœ€ç»ˆæä¾›ç»™å‰ç«¯åº”ç”¨ç¨‹åºæˆ–åŒºå—èµ„æºç®¡ç†å™¨ï¼‰ã€‚erroræ˜¯ä¸€ä¸ªä¸“é—¨ç”¨æ¥è¿”å›é”™è¯¯ï¼Œå¹¶ä¸”å¯ä»¥è‡ªå®šä¹‰è¿”å›å†…å®¹çš„ç±»å‹</p>
<p><code>send</code>ï¼š</p>
<p>è¿›è¡Œäº¤æ˜“çš„å‡½æ•°ã€‚æ­¤åˆçº¦ä¸­å…ˆåˆ¤æ–­å‘é€è€…çš„è´¦æˆ·ä¸Šæ˜¯å¦æœ‰è¶³å¤Ÿçš„ä½™é¢ï¼Œä½™é¢ä¸è¶³ç”¨<code>revert</code>è¯­å¥ä¸­æ­¢å¹¶å›é€€ã€‚ä½™é¢è¶³å¤Ÿåˆ™è¿›è¡Œè´¦æˆ·çš„äº¤æ˜“ã€‚äº¤æ˜“ç»“æŸåï¼Œä½¿ç”¨<code>emit</code>å…³é”®å­—è§¦å‘äº‹ä»¶</p>
<p><code>~~emit</code>å’Œ<code>evnet</code>éƒ½ä¸æ˜¯å¾ˆæ‡‚~~</p>
<h2 id="Knowledge-point"><a href="#Knowledge-point" class="headerlink" title="Knowledge point"></a>Knowledge point</h2><p><strong>çŠ¶æ€å˜é‡ã€å±€éƒ¨å˜é‡ã€å…¨å±€å˜é‡</strong></p>
<pre><code class="lang-solidity">pragma solidity ^0.5.0;

contract SolidityTest &#123;
   uint storedData; // çŠ¶æ€å˜é‡
   constructor() public &#123;
      storedData = 10;   
   &#125;
   function getResult() public view returns(uint)&#123;
      uint a = 1; // å±€éƒ¨å˜é‡
      uint b = 2;
      uint result = a + b;
      return result; // è®¿é—®å±€éƒ¨å˜é‡
   &#125;
&#125;
</code></pre>
<ul>
<li>çŠ¶æ€å˜é‡ï¼šå˜é‡å€¼æ°¸ä¹…ä¿å­˜åœ¨åˆçº¦å­˜å‚¨ç©ºé—´ä¸­çš„å˜é‡</li>
<li>å±€éƒ¨å˜é‡ï¼šå˜é‡å€¼ä»…åœ¨å‡½æ•°æ‰§è¡Œè¿‡ç¨‹ä¸­æœ‰æ•ˆçš„å˜é‡ï¼Œå‡½æ•°é€€å‡ºåï¼Œå˜é‡æ— æ•ˆ</li>
<li>å…¨å±€å˜é‡ï¼šå…¨å±€å·¥ä½œåŒºä¸­å­˜åœ¨çš„ç‰¹æ®Šå˜é‡ï¼Œæä¾›æœ‰å…³åŒºå—é“¾å’Œäº¤æ˜“å±æ€§çš„ä¿¡æ¯</li>
</ul>
<div class="table-container">
<table>
<thead>
<tr>
<th>åç§°</th>
<th>è¿”å›</th>
</tr>
</thead>
<tbody>
<tr>
<td>blockhash(uint blockNumber) returns (bytes32)</td>
<td>ç»™å®šåŒºå—çš„å“ˆå¸Œå€¼ â€“ åªé€‚ç”¨äº256æœ€è¿‘åŒºå—, ä¸åŒ…å«å½“å‰åŒºå—ã€‚</td>
</tr>
<tr>
<td>block.coinbase (address payable)</td>
<td>å½“å‰åŒºå—çŸ¿å·¥çš„åœ°å€</td>
</tr>
<tr>
<td>block.difficulty (uint)</td>
<td>å½“å‰åŒºå—çš„éš¾åº¦</td>
</tr>
<tr>
<td>block.gaslimit (uint)</td>
<td>å½“å‰åŒºå—çš„gaslimit</td>
</tr>
<tr>
<td>block.number (uint)</td>
<td>å½“å‰åŒºå—çš„number</td>
</tr>
<tr>
<td>block.timestamp (uint)</td>
<td>å½“å‰åŒºå—çš„æ—¶é—´æˆ³ï¼Œä¸ºunixçºªå…ƒä»¥æ¥çš„ç§’</td>
</tr>
<tr>
<td>gasleft() returns (uint256)</td>
<td>å‰©ä½™ gas</td>
</tr>
<tr>
<td>msg.data (bytes calldata)</td>
<td>å®Œæˆ calldata</td>
</tr>
<tr>
<td>msg.sender (address payable)</td>
<td>æ¶ˆæ¯å‘é€è€… (å½“å‰ caller)</td>
</tr>
<tr>
<td>msg.sig (bytes4)</td>
<td>calldataçš„å‰å››ä¸ªå­—èŠ‚ (function identifier)</td>
</tr>
<tr>
<td>msg.value (uint)</td>
<td>å½“å‰æ¶ˆæ¯çš„weiå€¼</td>
</tr>
<tr>
<td>now (uint)</td>
<td>å½“å‰å—çš„æ—¶é—´æˆ³</td>
</tr>
<tr>
<td>tx.gasprice (uint)</td>
<td>äº¤æ˜“çš„gasä»·æ ¼</td>
</tr>
<tr>
<td>tx.origin (address payable)</td>
<td>äº¤æ˜“çš„å‘é€æ–¹</td>
</tr>
</tbody>
</table>
</div>
<p><strong>å˜é‡ä½œç”¨åŸŸ</strong></p>
<ul>
<li><strong>Public</strong> â€“ å…¬å…±çŠ¶æ€å˜é‡å¯ä»¥åœ¨å†…éƒ¨è®¿é—®ï¼Œä¹Ÿå¯ä»¥é€šè¿‡æ¶ˆæ¯è®¿é—®ã€‚å¯¹äºå…¬å…±çŠ¶æ€å˜é‡ï¼Œå°†ç”Ÿæˆä¸€ä¸ªè‡ªåŠ¨getterå‡½æ•°ã€‚</li>
<li><strong>Internal</strong> â€“ å†…éƒ¨çŠ¶æ€å˜é‡åªèƒ½ä»å½“å‰åˆçº¦æˆ–å…¶æ´¾ç”Ÿåˆçº¦å†…è®¿é—®ã€‚</li>
<li><strong>Private</strong> â€“ ç§æœ‰çŠ¶æ€å˜é‡åªèƒ½ä»å½“å‰åˆçº¦å†…éƒ¨è®¿é—®ï¼Œæ´¾ç”Ÿåˆçº¦å†…ä¸èƒ½è®¿é—®ã€‚</li>
</ul>
<pre><code class="lang-solidity">pragma solidity ^0.5.0;

contract C &#123;
   uint public data = 30;
   uint internal iData= 10;

   function x() public returns (uint) &#123;
      data = 3; // å†…éƒ¨è®¿é—®
      return data;
   &#125;
&#125;
contract Caller &#123;
   C c = new C();
   function f() public view returns (uint) &#123;
      return c.data(); // å¤–éƒ¨è®¿é—®
   &#125;
&#125;
contract D is C &#123;
   uint storedData; // çŠ¶æ€å˜é‡

   function y() public returns (uint) &#123;
      iData = 3; // æ´¾ç”Ÿåˆçº¦å†…éƒ¨è®¿é—®
      return iData;
   &#125;
   function getResult() public view returns(uint)&#123;
      uint a = 1; // å±€éƒ¨å˜é‡
      uint b = 2;
      uint result = a + b;
      return storedData; // è®¿é—®çŠ¶æ€å˜é‡
   &#125;
&#125;
</code></pre>
<p><strong>æ¡ä»¶è¿ç®—ç¬¦</strong></p>
<p><code>?:</code>ï¼šå¦‚æœæ¡ä»¶ä¸ºçœŸï¼Ÿåˆ™å–å€¼Xï¼šå¦åˆ™å€¼Y</p>
<aside>
ğŸ’¡ example:`a > b? a: b`


</aside>

<p><strong>å¾ªç¯è¯­å¥</strong></p>
<p>ä¸cç±»ä¼¼</p>
<p><strong>æ¡ä»¶è¯­å¥</strong></p>
<p>ä¸cç±»ä¼¼</p>
<p><strong>å¼•ç”¨ç±»å‹/å¤åˆæ•°æ®ç±»å‹</strong></p>
<ul>
<li>æ•°ç»„(å­—ç¬¦ä¸²ä¸bytesæ˜¯ç‰¹æ®Šçš„æ•°ç»„ï¼Œæ‰€ä»¥ä¹Ÿæ˜¯å¼•ç”¨ç±»å‹)</li>
<li>structï¼ˆç»“æ„ä½“ï¼‰</li>
<li>mapï¼ˆæ˜ å°„ï¼‰</li>
</ul>
<p>è¿™äº›ç±»å‹æ¶‰åŠåˆ°çš„æ•°æ®é‡è¾ƒå¤§ï¼Œå¤åˆ¶å®ƒä»¬å¯èƒ½è¦æ¶ˆè€—å¤§é‡Gasï¼Œéå¸¸æ˜‚è´µï¼Œæ‰€ä»¥ä½¿ç”¨å®ƒä»¬æ—¶ï¼Œå¿…é¡»è€ƒè™‘å­˜å‚¨ä½ç½®ï¼Œä¾‹å¦‚ï¼Œæ˜¯ä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œè¿˜æ˜¯åœ¨EVMå­˜å‚¨åŒºä¸­</p>
<p><strong>æ•°æ®ä½ç½®</strong></p>
<p><code>Storageï¼ˆå­˜å‚¨ï¼‰</code>ï¼š</p>
<p>å­˜å‚¨æ°¸ä¹…æ•°æ®ï¼Œè¯¥æ•°æ®å¯ä»¥è¢«åˆçº¦ä¸­æ‰€æœ‰å‡½æ•°è®¿é—®ã€‚å¯ä»¥æŠŠå®ƒè§†ä¸ºç¡¬ç›˜æ•°æ®ï¼Œæ‰€æœ‰æ•°æ®éƒ½æ°¸ä¹…å­˜å‚¨ã€‚å› å…¶æ•°æ®å­˜å‚¨çš„æŒä¹…æ€§ï¼Œæ•…æˆæœ¬è¾ƒé«˜</p>
<p><code>Memoryï¼ˆå†…å­˜ï¼‰</code>ï¼š</p>
<p>ä¸´æ—¶æ•°æ®ï¼Œæ¯”Storageä¾¿å®œã€‚å®ƒåªèƒ½åœ¨å‡½æ•°ä¸­è®¿é—®ï¼Œå‡½æ•°æ‰§è¡Œå®Œæ¯•ï¼Œå®ƒçš„å†…å®¹å°±ä¼šè¢«ä¸¢å¼ƒ</p>
<p><code>Calldata</code>ï¼š</p>
<p>ä¸å¯ä¿®æ”¹çš„éæŒä¹…æ€§æ•°æ®ä½ç½®ï¼Œæ‰€æœ‰ä¼ é€’ç»™å‡½æ•°çš„å€¼ï¼Œéƒ½å­˜å‚¨åœ¨è¿™é‡Œã€‚Calladataä¹Ÿæ˜¯å¤–éƒ¨å‡½æ•°çš„å‚æ•°çš„é»˜è®¤ä½ç½®</p>
<p><code>Stackï¼ˆå †æ ˆï¼‰</code>ï¼š</p>
<p>EVMç»´æŠ¤çš„éæŒä¹…æ€§æ•°æ®ï¼ŒEVMä½¿ç”¨å †æ ˆæ•°æ®ä½ç½®åœ¨æ‰§è¡ŒæœŸé—´åŠ è½½å˜é‡ã€‚æœ€å¤šæœ‰1024ä¸ªçº§åˆ«çš„é™åˆ¶</p>
<aside>
ğŸ’¡ æ˜¾ç¤ºæ ‡è®°å˜é‡çš„ä½ç½®ï¼š`æ•°æ®ç±»å‹ æ•°æ®ä½ç½® å˜é‡å`


</aside>

<p><strong>å˜é‡æ•°æ®ä½ç½®è§„åˆ™</strong></p>
<ul>
<li>çŠ¶æ€å˜é‡ï¼šå­˜å‚¨åœ¨å­˜å‚¨åŒºä¸­ã€‚æ­¤å¤–ï¼Œä¸èƒ½æ˜¾å¼æ ‡è®°çŠ¶æ€å˜é‡çš„ä½ç½®</li>
<li>å‡½æ•°å‚æ•°ä¸è¿”å›å€¼ï¼šå­˜å‚¨åœ¨å†…å­˜ä¸­</li>
<li>å±€éƒ¨å˜é‡ï¼šå€¼ç±»å‹å­˜å‚¨åœ¨å†…å­˜ä¸­<code>å¦‚uint,bool,address</code>ï¼Œå¼•ç”¨ç±»å‹<code>æ•°ç»„ï¼Œstructï¼Œmap</code>éœ€è¦æ˜¾å¼åœ°æŒ‡å®šæ•°æ®ä½ç½®</li>
<li>å¤–éƒ¨å‡½æ•°çš„å‚æ•°ï¼šå­˜å‚¨åœ¨Calldataä¸­</li>
</ul>
<p><strong>æšä¸¾ï¼ˆEnumï¼‰</strong></p>
<p>æšä¸¾å°†ä¸€ä¸ªå˜é‡çš„å–å€¼é™åˆ¶ä¸ºå‡ ä¸ªé¢„å®šä¹‰å€¼ä¸­çš„ä¸€ä¸ªã€‚ç²¾ç¡®ä½¿ç”¨æšä¸¾ç±»å‹æœ‰åŠ©äºå‡å°‘ä»£ç ä¸­çš„bug</p>
<pre><code class="lang-solidity">//SPDX-License-Identifier: GPL-3.0

pragma solidity ^0.8.0;

contract test &#123;
   enum FreshJuiceSize&#123; SMALL, MEDIUM, LARGE &#125;
   FreshJuiceSize choice;
   FreshJuiceSize constant defaultChoice = FreshJuiceSize.MEDIUM;

   function setLarge() public &#123;
      choice = FreshJuiceSize.LARGE;
   &#125;
   function getChoice() public view returns (FreshJuiceSize) &#123;
      return choice;
   &#125;
   function getDefaultChoice() public pure returns (uint) &#123;
      return uint(defaultChoice);
   &#125;
&#125;
</code></pre>
<p><strong>ç»“æ„ä½“ï¼ˆStructï¼‰</strong></p>
<p>ä¸Cç±»ä¼¼</p>
<pre><code class="lang-solidity">//SPDX-License-Identifier: GPL-3.0
pragma solidity ^0.5.0;

contract test &#123;
   struct Book &#123; 
      string title;
      string author;
      uint book_id;
   &#125;
   Book book;

   function setBook() public &#123;
      book = Book(&#39;Learn Java&#39;, &#39;TP&#39;, 1);
   &#125;
   function getBookId() public view returns (uint) &#123;
      return book.book_id;
   &#125;
&#125;
</code></pre>
<p><strong>æ˜ å°„ï¼ˆmappingï¼‰</strong></p>
<pre><code class="lang-solidity">mapping(_KeyType =&gt; _ValueType)
</code></pre>
<ul>
<li><code>_KeyType</code> ï¼šå¯ä»¥æ˜¯ä»»ä½•å†…ç½®ç±»å‹ï¼Œæˆ–è€…byteså’Œå­—ç¬¦ä¸²ã€‚ä¸å…è®¸ä½¿ç”¨å¼•ç”¨ç±»å‹æˆ–å¤æ‚å¯¹è±¡</li>
<li><code>_ValueType</code> ï¼š å¯ä»¥æ˜¯ä»»ä½•ç±»å‹</li>
</ul>
<p>æ³¨æ„</p>
<ul>
<li>æ˜ å°„çš„æ•°æ®ä½ç½®(data location)åªèƒ½æ˜¯storageï¼Œé€šå¸¸ç”¨äºçŠ¶æ€å˜é‡</li>
<li>æ˜ å°„å¯ä»¥æ ‡è®°ä¸ºpublicï¼ŒSolidity è‡ªåŠ¨ä¸ºå®ƒåˆ›å»ºgetter</li>
</ul>
<pre><code class="lang-solidity">pragma solidity ^0.5.0;

contract LedgerBalance &#123;
   mapping(address =&gt; uint) public balances;

   function updateBalance(uint newBalance) public &#123;
      balances[msg.sender] = newBalance;
   &#125;
&#125;
contract Updater &#123;
   function updateBalance() public returns (uint) &#123;
      LedgerBalance ledgerBalance = new LedgerBalance();
      ledgerBalance.updateBalance(10);
      return ledgerBalance.balances(address(this));
   &#125;
&#125;
</code></pre>
<p>å¯¹ç¤ºä¾‹ä»£ç å†™ä¸€ç‚¹è‡ªå·±çš„ç†è§£ï¼š</p>
<p>addressæ˜¯ä¸å¯è¢«è¿ç®—çš„æ•°æ®ç±»å‹ï¼Œå› æ­¤éœ€è¦mapæ˜ å°„ä¸ºuintï¼Œå†å‚ä¸è¿ç®—</p>
<p><strong>ç±»å‹è½¬æ¢</strong></p>
<p>å¯ä»¥ä½¿ç”¨æ„é€ å‡½æ•°è¯­æ³•ï¼Œæ˜¾å¼åœ°å°†æ•°æ®ç±»å‹è½¬æ¢ä¸ºå¦ä¸€ç§ç±»å‹ã€‚</p>
<pre><code class="lang-solidity">int8 y = -3;
uint x = uint(y);
//Now x = 0xfffff..fd == åœ¨256bité•¿åº¦çš„æ ¼å¼ä¸‹ï¼Œ-3çš„è¡¥ç è¡¨ç¤º
</code></pre>
<p>è½¬æ¢æˆæ›´å°çš„ç±»å‹ï¼Œä¼šä¸¢å¤±é«˜ä½ã€‚</p>
<pre><code class="lang-solidity">uint32 a = 0x12345678;
uint16 b = uint16(a); // b = 0x5678
</code></pre>
<p>è½¬æ¢æˆæ›´å¤§çš„ç±»å‹ï¼Œå°†å‘å·¦ä¾§æ·»åŠ å¡«å……ä½ã€‚</p>
<pre><code class="lang-solidity">uint16 a = 0x1234;
uint32 b = uint32(a); // b = 0x00001234
</code></pre>
<p>è½¬æ¢åˆ°æ›´å°çš„å­—èŠ‚ç±»å‹ï¼Œä¼šä¸¢å¤±åé¢æ•°æ®ã€‚</p>
<pre><code class="lang-solidity">bytes2 a = 0x1234;
bytes1 b = bytes1(a); // b = 0x12
</code></pre>
<p>è½¬æ¢ä¸ºæ›´å¤§çš„å­—èŠ‚ç±»å‹æ—¶ï¼Œå‘å³æ·»åŠ å¡«å……ä½ã€‚</p>
<pre><code class="lang-solidity">bytes2 a = 0x1234;
bytes4 b = bytes4(a); // b = 0x12340000
</code></pre>
<p>åªæœ‰å½“å­—èŠ‚ç±»å‹å’Œintç±»å‹å¤§å°ç›¸åŒæ—¶ï¼Œæ‰å¯ä»¥è¿›è¡Œè½¬æ¢ã€‚</p>
<pre><code class="lang-solidity">bytes2 a = 0x1234;
uint32 b = uint16(a); // b = 0x00001234
uint32 c = uint32(bytes4(a)); // c = 0x12340000
uint8 d = uint8(uint16(a)); // d = 0x34
uint8 e = uint8(bytes1(a)); // e = 0x12
</code></pre>
<p>æŠŠæ•´æ•°èµ‹å€¼ç»™æ•´å‹æ—¶ï¼Œä¸èƒ½è¶…å‡ºèŒƒå›´ï¼Œå‘ç”Ÿæˆªæ–­ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚</p>
<pre><code class="lang-solidity">uint8 a = 12; // no error
uint32 b = 1234; // no error
uint16 c = 0x123456; // error, æœ‰æˆªæ–­ï¼Œå˜ä¸º 0x3456
</code></pre>
<p><strong>ä»¥å¤ªå•ä½</strong></p>
<p>Solidity ä¸­ï¼Œä»¥å¤ªå¸çš„å•ä½å¯ä»¥ä½¿ç”¨<code>wei</code>ã€<code>finney</code>ã€<code>szabo</code>æˆ–<code>ether</code>è¡¨ç¤ºã€‚</p>
<p>æœ€å°çš„å•ä½æ˜¯<code>wei</code>ã€‚<code>1e12</code>è¡¨ç¤º<code>1 x 10^12</code>ã€‚</p>
<pre><code class="lang-solidity">assert(1 wei == 1);
assert(1 szabo == 1e12);
assert(1 finney == 1e15);
assert(1 ether == 1e18);
</code></pre>
<p><strong>å‡½æ•°</strong></p>
<p>è¯­æ³•ï¼š</p>
<pre><code class="lang-solidity">function function-name(parameter-list) scope returns() &#123;
   //è¯­å¥
&#125;
</code></pre>
<p>returnè¯­å¥å¯ä»¥è¿”å›å¤šä¸ªå€¼</p>
<pre><code class="lang-solidity">pragma solidity ^0.5.0;

contract Test &#123;
   function getResult() public view returns(uint product, uint sum)&#123;
      uint a = 1; // å±€éƒ¨å˜é‡
      uint b = 2;
      product = a * b; // ä½¿ç”¨è¿”å›å‚æ•°è¿”å›å€¼
      sum = a + b; // ä½¿ç”¨è¿”å›å‚æ•°è¿”å›å€¼

      // ä¹Ÿå¯ä»¥ä½¿ç”¨returnè¿”å›å¤šä¸ªå€¼
      // return(a*b, a+b);
   &#125;
&#125;
</code></pre>
<p>ä¿®é¥°ç¬¦ï¼š</p>
<p>å‡½æ•°ä¿®é¥°ç¬¦ç”¨äºä¿®æ”¹å‡½æ•°çš„è¡Œä¸ºã€‚ä¾‹å¦‚ï¼Œå‘å‡½æ•°æ·»åŠ æ¡ä»¶é™åˆ¶ã€‚</p>
<p>ä¿®é¥°ç¬¦å®šä¹‰ä¸­å‡ºç°ç‰¹æ®Šç¬¦å·<code>_</code><br>çš„åœ°æ–¹ï¼Œç”¨äºæ’å…¥å‡½æ•°ä½“ã€‚å¦‚æœåœ¨è°ƒç”¨æ­¤å‡½æ•°æ—¶ï¼Œæ»¡è¶³äº†ä¿®é¥°ç¬¦çš„æ¡ä»¶ï¼Œåˆ™æ‰§è¡Œè¯¥å‡½æ•°ï¼Œå¦åˆ™å°†æŠ›å‡ºå¼‚å¸¸ã€‚</p>
<pre><code class="lang-solidity">pragma solidity ^0.5.0;

contract Owner &#123;
   address owner;

   constructor() public &#123;
      owner = msg.sender;
   &#125;

   // å®šä¹‰ä¿®é¥°ç¬¦ onlyOwner ä¸å¸¦å‚æ•°
   modifier onlyOwner &#123;
      require(msg.sender == owner);
      _;
   &#125;

   // å®šä¹‰ä¿®é¥°ç¬¦ costs å¸¦å‚æ•°
   modifier costs(uint price) &#123;
      if (msg.value &gt;= price) &#123;
         _;
      &#125;
   &#125;
&#125;

contract Register is Owner &#123;
   mapping (address =&gt; bool) registeredAddresses;
   uint price;

   constructor(uint initialPrice) public &#123; price = initialPrice; &#125;

   // ä½¿ç”¨ä¿®é¥°ç¬¦ costs
   function register() public payable costs(price) &#123;
      registeredAddresses[msg.sender] = true;
   &#125;

   // ä½¿ç”¨ä¿®é¥°ç¬¦ onlyOwner
   function changePrice(uint _price) public onlyOwner &#123;
      price = _price;
   &#125;
&#125;
</code></pre>
<p>å…¶ä¸­<code>onlyOwner</code>å’Œ<code>costs</code>æ˜¯ä¿®é¥°ç¬¦</p>
<p>view(è§†å›¾)å‡½æ•°ï¼š</p>
<p>View(è§†å›¾)å‡½æ•°ä¸ä¼šä¿®æ”¹çŠ¶æ€ã€‚å¦‚æœå‡½æ•°ä¸­å­˜åœ¨ä»¥ä¸‹è¯­å¥ï¼Œåˆ™è¢«è§†ä¸ºä¿®æ”¹çŠ¶æ€ï¼Œç¼–è¯‘å™¨å°†æŠ›å‡ºè­¦å‘Šã€‚</p>
<ul>
<li>ä¿®æ”¹çŠ¶æ€å˜é‡ã€‚</li>
<li>è§¦å‘äº‹ä»¶ã€‚</li>
<li>åˆ›å»ºåˆçº¦ã€‚</li>
<li>ä½¿ç”¨<code>selfdestruct</code>ã€‚</li>
<li>å‘é€ä»¥å¤ªã€‚</li>
<li>è°ƒç”¨ä»»ä½•ä¸æ˜¯è§†å›¾å‡½æ•°æˆ–çº¯å‡½æ•°çš„å‡½æ•°</li>
<li>ä½¿ç”¨åº•å±‚è°ƒç”¨</li>
<li>ä½¿ç”¨åŒ…å«æŸäº›æ“ä½œç çš„å†…è”ç¨‹åºé›†ã€‚</li>
</ul>
<p>Getteræ–¹æ³•æ˜¯é»˜è®¤çš„è§†å›¾å‡½æ•°ã€‚å£°æ˜è§†å›¾å‡½æ•°ï¼Œå¯ä»¥åœ¨å‡½æ•°å£°æ˜é‡Œï¼Œæ·»åŠ <code>view</code>å…³é”®å­—ã€‚</p>
<pre><code class="lang-solidity">pragma solidity ^0.5.0;

contract Test &#123;
   function getResult() public view returns(uint product, uint sum)&#123;
      uint a = 1; // å±€éƒ¨å˜é‡
      uint b = 2;
      product = a * b;
      sum = a + b; 
   &#125;
&#125;
</code></pre>
<p>pure(çº¯)å‡½æ•°ï¼š</p>
<p>Pure(çº¯)å‡½æ•°<strong>ä¸è¯»å–</strong>æˆ–ä¿®æ”¹çŠ¶æ€ã€‚å¦‚æœå‡½æ•°ä¸­å­˜åœ¨ä»¥ä¸‹è¯­å¥ï¼Œåˆ™è¢«è§†ä¸ºè¯»å–çŠ¶æ€ï¼Œç¼–è¯‘å™¨å°†æŠ›å‡ºè­¦å‘Šã€‚</p>
<ul>
<li>è¯»å–çŠ¶æ€å˜é‡ã€‚</li>
<li>è®¿é—® <code>address(this).balance</code> æˆ– <code>&lt;address&gt;.balance</code></li>
<li>è®¿é—®ä»»ä½•åŒºå—ã€äº¤æ˜“ã€msgç­‰ç‰¹æ®Šå˜é‡(msg.sig ä¸ msg.data å…è®¸è¯»å–)ã€‚</li>
<li>è°ƒç”¨ä»»ä½•ä¸æ˜¯çº¯å‡½æ•°çš„å‡½æ•°ã€‚</li>
<li>ä½¿ç”¨åŒ…å«ç‰¹å®šæ“ä½œç çš„å†…è”ç¨‹åºé›†ã€‚</li>
</ul>
<p>å¦‚æœå‘ç”Ÿé”™è¯¯ï¼Œçº¯å‡½æ•°å¯ä»¥ä½¿ç”¨<code>revert()</code>å’Œ<code>require()</code>å‡½æ•°æ¥è¿˜åŸæ½œåœ¨çš„çŠ¶æ€æ›´æ”¹ã€‚</p>
<p>å£°æ˜çº¯å‡½æ•°ï¼Œå¯ä»¥åœ¨å‡½æ•°å£°æ˜é‡Œï¼Œæ·»åŠ <code>pure</code>å…³é”®å­—ã€‚</p>
<pre><code class="lang-solidity">pragma solidity ^0.5.0;

contract Test &#123;
   function getResult() public pure returns(uint product, uint sum)&#123;
      uint a = 1; 
      uint b = 2;
      product = a * b;
      sum = a + b; 
   &#125;
&#125;
</code></pre>
<p>fallback(å›é€€)å‡½æ•°ï¼š</p>
<p>fallback(å›é€€) å‡½æ•°æ˜¯åˆçº¦ä¸­çš„ç‰¹æ®Šå‡½æ•°ã€‚å®ƒæœ‰ä»¥ä¸‹ç‰¹ç‚¹</p>
<ul>
<li>å½“åˆçº¦ä¸­ä¸å­˜åœ¨çš„å‡½æ•°è¢«è°ƒç”¨æ—¶ï¼Œå°†è°ƒç”¨fallbackå‡½æ•°ã€‚</li>
<li>è¢«æ ‡è®°ä¸ºå¤–éƒ¨å‡½æ•°ã€‚</li>
<li>å®ƒæ²¡æœ‰åå­—ã€‚</li>
<li>å®ƒæ²¡æœ‰å‚æ•°ã€‚</li>
<li>å®ƒä¸èƒ½è¿”å›ä»»ä½•ä¸œè¥¿ã€‚</li>
<li>æ¯ä¸ªåˆçº¦å®šä¹‰ä¸€ä¸ªfallbackå‡½æ•°ã€‚</li>
<li>å¦‚æœæ²¡æœ‰è¢«æ ‡è®°ä¸º<code>payable</code>ï¼Œåˆ™å½“åˆçº¦æ”¶åˆ°æ— æ•°æ®çš„ä»¥å¤ªå¸è½¬è´¦æ—¶ï¼Œå°†æŠ›å‡ºå¼‚å¸¸ã€‚</li>
</ul>
<p>è¯­æ³•</p>
<pre><code class="lang-solidity">// æ²¡æœ‰åå­—ï¼Œæ²¡æœ‰å‚æ•°ï¼Œä¸è¿”å›ï¼Œæ ‡è®°ä¸ºexternalï¼Œå¯ä»¥æ ‡è®°ä¸ºpayable
function() external &#123;
    // statements
&#125;
</code></pre>
<p>ä¸‹é¢çš„ç¤ºä¾‹å±•ç¤ºäº†åˆçº¦ä¸­çš„å›é€€å‡½æ•°æ¦‚å¿µã€‚</p>
<pre><code class="lang-solidity">pragma solidity ^0.5.0;

contract Test &#123;
   uint public x ;
   function() external &#123; x = 1; &#125;    
&#125;
contract Sink &#123;
   function() external payable &#123; &#125;
&#125;
contract Caller &#123;

   function callTest(Test test) public returns (bool) &#123;
      (bool success,) = address(test).call(abi.encodeWithSignature(&quot;nonExistingFunction()&quot;));
      require(success);
      // test.x æ˜¯ 1

      address payable testPayable = address(uint160(address(test)));

      // å‘é€ä»¥å¤ªæµ‹è¯•åˆåŒ,
      // è½¬è´¦å°†å¤±è´¥ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™é‡Œè¿”å›falseã€‚
      return (testPayable.send(2 ether));
   &#125;

   function callSink(Sink sink) public returns (bool) &#123;
      address payable sinkPayable = address(sink);
      return (sinkPayable.send(2 ether));
   &#125;
&#125;
</code></pre>
<p><strong>å‡½æ•°é‡è½½</strong></p>
<p>åŒä¸€ä¸ªä½œç”¨åŸŸå†…ï¼Œç›¸åŒå‡½æ•°åå¯ä»¥å®šä¹‰å¤šä¸ªå‡½æ•°ã€‚è¿™äº›å‡½æ•°çš„å‚æ•°(å‚æ•°ç±»å‹æˆ–å‚æ•°æ•°é‡)å¿…é¡»ä¸ä¸€æ ·ã€‚ä»…ä»…æ˜¯è¿”å›å€¼ä¸ä¸€æ ·ä¸è¢«å…è®¸</p>
<pre><code class="lang-solidity">pragma solidity ^0.5.0;

contract Test &#123;
   function getSum(uint a, uint b) public pure returns(uint)&#123;      
      return a + b;
   &#125;
   function getSum(uint a, uint b, uint c) public pure returns(uint)&#123;      
      return a + b + c;
   &#125;
   function callSumWithTwoArguments() public pure returns(uint)&#123;
      return getSum(1,2);
   &#125;
   function callSumWithThreeArguments() public pure returns(uint)&#123;
      return getSum(1,2,3);
   &#125;
&#125;

//0: uint256: 3
//0: uint256: 6
</code></pre>
<p><strong>æ•°å­¦å‡½æ•°</strong></p>
<p>Solidityæä¾›å†…ç½®çš„æ•°å­¦å‡½æ•°ï¼Œå¦‚ï¼š</p>
<ul>
<li><code>addmod(uint x, uint y, uint k) returns (uint)</code> è®¡ç®—(x + y) % kï¼Œè®¡ç®—ä¸­ï¼Œä»¥ä»»æ„ç²¾åº¦æ‰§è¡ŒåŠ æ³•ï¼Œä¸”ä¸é™äº2^256å¤§å°ã€‚</li>
<li><code>mulmod(uint x, uint y, uint k) returns (uint)</code> è®¡ç®—(x * y) % kï¼Œè®¡ç®—ä¸­ï¼Œä»¥ä»»æ„ç²¾åº¦æ‰§è¡Œä¹˜æ³•ï¼Œä¸”ä¸é™äº2^256å¤§å°ã€‚</li>
</ul>
<p><strong>åŠ å¯†å‡½æ•°</strong></p>
<p>Solidity æä¾›äº†å¸¸ç”¨çš„åŠ å¯†å‡½æ•°ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›é‡è¦å‡½æ•°ï¼š</p>
<ul>
<li><code>keccak256(bytes memory) returns (bytes32)</code> è®¡ç®—è¾“å…¥çš„Keccak-256æ•£åˆ—ã€‚</li>
<li><code>sha256(bytes memory) returns (bytes32)</code> è®¡ç®—è¾“å…¥çš„SHA-256æ•£åˆ—ã€‚</li>
<li><code>ripemd160(bytes memory) returns (bytes20)</code> è®¡ç®—è¾“å…¥çš„RIPEMD-160æ•£åˆ—ã€‚</li>
<li><code>ecrecover(bytes32 hash, uint8 v, bytes32 r, bytes32 s) returns (address)</code> ä»æ¤­åœ†æ›²çº¿ç­¾åä¸­æ¢å¤ä¸å…¬é’¥ç›¸å…³çš„åœ°å€ï¼Œæˆ–åœ¨å‡ºé”™æ—¶è¿”å›é›¶ã€‚å‡½æ•°å‚æ•°å¯¹åº”äºç­¾åçš„ECDSAå€¼: r â€“ ç­¾åçš„å‰32å­—èŠ‚; s: ç­¾åçš„ç¬¬äºŒä¸ª32å­—èŠ‚; v: ç­¾åçš„æœ€åä¸€ä¸ªå­—èŠ‚ã€‚è¿™ä¸ªæ–¹æ³•è¿”å›ä¸€ä¸ªåœ°å€ã€‚</li>
</ul>
<p><strong>åˆçº¦ç»§æ‰¿</strong></p>
<pre><code class="lang-solidity">pragma solidity ^0.8.0;

contract A &#123;
   ...
&#125;

contract B is A &#123;
   ...
&#125;
</code></pre>
<p><strong>æ„é€ å‡½æ•°</strong></p>
<p>æ„é€ å‡½æ•°æ˜¯ä½¿ç”¨<code>construct</code>å…³é”®å­—å£°æ˜çš„ç‰¹æ®Šå‡½æ•°ï¼Œç”¨äºåˆå§‹åŒ–åˆçº¦çš„çŠ¶æ€å˜é‡ã€‚åˆçº¦ä¸­æ„é€ å‡½æ•°æ˜¯å¯é€‰çš„ï¼Œå¯ä»¥çœç•¥ã€‚</p>
<p>æ„é€ å‡½æ•°æœ‰ä»¥ä¸‹é‡è¦ç‰¹æ€§ï¼š</p>
<ul>
<li>ä¸€ä¸ªåˆçº¦åªèƒ½æœ‰ä¸€ä¸ªæ„é€ å‡½æ•°ã€‚</li>
<li>æ„é€ å‡½æ•°åœ¨åˆ›å»ºåˆçº¦æ—¶æ‰§è¡Œä¸€æ¬¡ï¼Œç”¨äºåˆå§‹åŒ–åˆçº¦çŠ¶æ€ã€‚</li>
<li>åœ¨æ‰§è¡Œæ„é€ å‡½æ•°ä¹‹åï¼Œåˆçº¦æœ€ç»ˆä»£ç è¢«éƒ¨ç½²åˆ°åŒºå—é“¾ã€‚åˆçº¦æœ€ç»ˆä»£ç åŒ…æ‹¬å…¬å…±å‡½æ•°å’Œå¯é€šè¿‡å…¬å…±å‡½æ•°è®¿é—®çš„ä»£ç ã€‚æ„é€ å‡½æ•°ä»£ç æˆ–ä»…ç”±æ„é€ å‡½æ•°ä½¿ç”¨çš„ä»»ä½•å†…éƒ¨æ–¹æ³•ä¸åŒ…æ‹¬åœ¨æœ€ç»ˆä»£ç ä¸­ã€‚</li>
<li>æ„é€ å‡½æ•°å¯ä»¥æ˜¯å…¬å…±çš„ï¼Œä¹Ÿå¯ä»¥æ˜¯å†…éƒ¨çš„ã€‚</li>
<li>å†…éƒ¨æ„é€ å‡½æ•°å°†åˆçº¦æ ‡è®°ä¸ºæŠ½è±¡åˆçº¦ã€‚</li>
<li>å¦‚æœæ²¡æœ‰å®šä¹‰æ„é€ å‡½æ•°ï¼Œåˆ™ä½¿ç”¨é»˜è®¤æ„é€ å‡½æ•°ã€‚</li>
</ul>
<pre><code class="lang-solidity">pragma solidity ^0.5.0;

contract Test &#123;
   constructor() public &#123;&#125;
&#125;
</code></pre>
<ul>
<li>å¦‚æœåŸºåˆçº¦å…·æœ‰å¸¦å‚æ•°çš„æ„é€ å‡½æ•°ï¼Œåˆ™æ¯ä¸ªæ´¾ç”Ÿ/ç»§æ‰¿çš„åˆçº¦ä¹Ÿéƒ½å¿…é¡»åŒ…å«å‚æ•°ã€‚</li>
<li>å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„æ–¹æ³•ç›´æ¥åˆå§‹åŒ–åŸºæ„é€ å‡½æ•°</li>
</ul>
<pre><code class="lang-solidity">pragma solidity ^0.5.0;

contract Base &#123;
   uint data;
   constructor(uint _data) public &#123;
      data = _data;
   &#125;
&#125;
contract Derived is Base (5) &#123;
   constructor() public &#123;&#125;
&#125;
</code></pre>
<ul>
<li>å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•é—´æ¥åˆå§‹åŒ–åŸºæ„é€ å‡½æ•°</li>
</ul>
<pre><code class="lang-solidity">pragma solidity ^0.5.0;

contract Base &#123;
   uint data;
   constructor(uint _data) public &#123;
      data = _data;
   &#125;
&#125;
contract Derived is Base &#123;
   constructor(uint _info) Base(_info * _info) public &#123;&#125;
&#125;
</code></pre>
<ul>
<li>ä¸å…è®¸ç›´æ¥æˆ–é—´æ¥åœ°åˆå§‹åŒ–åŸºåˆçº¦æ„é€ å‡½æ•°ã€‚</li>
<li>å¦‚æœæ´¾ç”Ÿåˆçº¦æ²¡æœ‰å°†å‚æ•°ä¼ é€’ç»™åŸºåˆçº¦æ„é€ å‡½æ•°ï¼Œåˆ™æ´¾ç”Ÿåˆçº¦å°†æˆä¸ºæŠ½è±¡åˆçº¦ã€‚</li>
</ul>
<p><strong>æŠ½è±¡åˆçº¦</strong></p>
<pre><code class="lang-solidity">pragma solidity ^0.5.0;

contract Calculator &#123;
   function getResult() public view returns(uint);
&#125;

contract Test is Calculator &#123;
   function getResult() public view returns(uint) &#123;
      uint a = 1;
      uint b = 2;
      uint result = a + b;
      return result;
   &#125;
&#125;
</code></pre>
<p><strong>æ¥å£</strong></p>
<p>æ¥å£ç±»ä¼¼äºæŠ½è±¡åˆçº¦ï¼Œä½¿ç”¨<code>interface</code>å…³é”®å­—åˆ›å»ºï¼Œæ¥å£åªèƒ½åŒ…å«æŠ½è±¡å‡½æ•°ï¼Œä¸èƒ½åŒ…å«å‡½æ•°å®ç°ã€‚ä»¥ä¸‹æ˜¯æ¥å£çš„å…³é”®ç‰¹æ€§ï¼š</p>
<ul>
<li>æ¥å£çš„å‡½æ•°åªèƒ½æ˜¯å¤–éƒ¨ç±»å‹ã€‚</li>
<li>æ¥å£ä¸èƒ½æœ‰æ„é€ å‡½æ•°ã€‚</li>
<li>æ¥å£ä¸èƒ½æœ‰çŠ¶æ€å˜é‡ã€‚</li>
<li>æ¥å£å¯ä»¥åŒ…å«enumã€structå®šä¹‰ï¼Œå¯ä»¥ä½¿ç”¨<code>interface_name.</code>è®¿é—®å®ƒä»¬ã€‚</li>
</ul>
<pre><code class="lang-solidity">pragma solidity ^0.5.0;

interface Calculator &#123;
   function getResult() external view returns(uint);
&#125;

contract Test is Calculator &#123;
   constructor() public &#123;&#125;
   function getResult() external view returns(uint)&#123;
      uint a = 1; 
      uint b = 2;
      uint result = a + b;
      return result;
   &#125;
&#125;
</code></pre>
<p><strong>åº“</strong></p>
<p>Solidityä¸­ï¼Œå¯¹åº“çš„ä½¿ç”¨æœ‰ä¸€å®šçš„é™åˆ¶ã€‚ä»¥ä¸‹æ˜¯åº“çš„ä¸»è¦ç‰¹å¾ã€‚</p>
<ul>
<li>å¦‚æœåº“å‡½æ•°ä¸ä¿®æ”¹çŠ¶æ€ï¼Œåˆ™å¯ä»¥ç›´æ¥è°ƒç”¨å®ƒä»¬ã€‚è¿™æ„å‘³ç€<a target="_blank" rel="noopener" href="https://www.qikegu.com/docs/4963">çº¯å‡½æ•°</a>æˆ–<a target="_blank" rel="noopener" href="https://www.qikegu.com/docs/4961">è§†å›¾å‡½æ•°</a>åªèƒ½ä»åº“å¤–éƒ¨è°ƒç”¨ã€‚</li>
<li>åº“ä¸èƒ½è¢«é”€æ¯ï¼Œå› ä¸ºå®ƒè¢«è®¤ä¸ºæ˜¯æ— çŠ¶æ€çš„ã€‚</li>
<li>åº“ä¸èƒ½æœ‰çŠ¶æ€å˜é‡ã€‚</li>
<li>åº“ä¸èƒ½ç»§æ‰¿ä»»ä½•å…¶ä»–å…ƒç´ ã€‚</li>
<li>åº“ä¸èƒ½è¢«ç»§æ‰¿ã€‚</li>
</ul>
<p>ä½¿ç”¨libraryå£°æ˜ï¼Œä½¿ç”¨<code>&lt;library_name&gt;.&lt;func_name&gt;</code></p>
<pre><code class="lang-solidity">pragma solidity ^0.5.0;

library Search &#123;
   function indexOf(uint[] storage self, uint value) public view returns (uint) &#123;
      for (uint i = 0; i &lt; self.length; i++) if (self[i] == value) return i;
      return uint(-1);
   &#125;
&#125;
contract Test &#123;
   uint[] data;
   constructor() public &#123;
      data.push(1);
      data.push(2);
      data.push(3);
      data.push(4);
      data.push(5);
   &#125;
   function isValuePresent() external view returns(uint)&#123;
      uint value = 4;

      // ä½¿ç”¨åº“å‡½æ•°æœç´¢æ•°ç»„ä¸­æ˜¯å¦å­˜åœ¨å€¼
      uint index = Search.indexOf(data, value);
      return index;
   &#125;
&#125;
</code></pre>
<p><strong><strong>ä½¿ç”¨æ±‡ç¼–(Assembly)ä»£ç </strong></strong></p>
<p>ä½¿ç”¨å†…è”æ±‡ç¼–ï¼Œå¯ä»¥åœ¨solidityä¸­åµŒå…¥æ±‡ç¼–ä»£ç ï¼Œä½¿ç”¨</p>
<pre><code class="lang-solidity">assembly&#123;
    ...
&#125;
</code></pre>
<p><strong>äº‹ä»¶</strong></p>
<p>äº‹ä»¶æ˜¯æ™ºèƒ½åˆçº¦å‘å‡ºçš„ä¿¡å·ã€‚æ™ºèƒ½åˆçº¦çš„å‰ç«¯UIï¼Œä¾‹å¦‚ï¼ŒDAppsã€web.jsï¼Œæˆ–è€…ä»»ä½•ä¸Ethereum JSON-RPC APIè¿æ¥çš„ä¸œè¥¿ï¼Œéƒ½å¯ä»¥ä¾¦å¬è¿™äº›äº‹ä»¶ã€‚äº‹ä»¶å¯ä»¥è¢«ç´¢å¼•ï¼Œä»¥ä¾¿ä»¥åå¯ä»¥æœç´¢äº‹ä»¶è®°å½•ã€‚</p>
<blockquote>
<p>äº‹ä»¶åœ¨åŒºå—é“¾ä¸­çš„å­˜å‚¨</p>
<p>åŒºå—é“¾æ˜¯ä¸€ä¸ªåŒºå—é“¾è¡¨ï¼Œè¿™äº›å—çš„å†…å®¹åŸºæœ¬ä¸Šæ˜¯äº¤æ˜“è®°å½•ã€‚æ¯ä¸ªäº¤æ˜“éƒ½æœ‰ä¸€ä¸ªé™„åŠ çš„äº¤æ˜“æ—¥å¿—ï¼Œäº‹ä»¶ç»“æœå­˜æ”¾åœ¨äº¤æ˜“æ—¥å¿—é‡Œã€‚åˆçº¦å‘å‡ºçš„äº‹ä»¶ï¼Œå¯ä»¥ä½¿ç”¨åˆçº¦åœ°å€è®¿é—®ã€‚</p>
</blockquote>
<p>Solidityä¸­å¯ä»¥ä½¿ç”¨<code>event</code>å…³é”®å­—(åœ¨ç”¨æ³•ä¸Šç±»ä¼¼äº<code>function</code>å…³é”®å­—)ã€‚ç„¶åå¯ä»¥åœ¨å‡½æ•°ä¸­ä½¿ç”¨<code>emit</code>å…³é”®å­—è§¦å‘äº‹ä»¶</p>
<p>åˆ›å»ºåˆçº¦å¹¶å‘å‡ºä¸€ä¸ªäº‹ä»¶</p>
<pre><code class="lang-solidity">pragma solidity ^0.5.0;

contract Counter &#123;
    uint256 public count = 0;

    event Increment(address who);   // å£°æ˜äº‹ä»¶

    function increment() public &#123;
        emit Increment(msg.sender); // è§¦å‘äº‹ä»¶
        count += 1;
    &#125;
&#125;
</code></pre>
  </div>
  
    
      <a id="older" class="blog-nav" href="/2023/02/05/%E8%AE%B0%E4%B8%80%E4%B8%AANTRU%E6%9D%BF%E5%AD%90%E9%A2%98/">OLDER&nbsp;&gt;</a>
      
        
          <a id="newer" class="blog-nav" href="/2023/07/11/AES%E7%9B%B8%E5%85%B3%E5%8A%9F%E8%80%97%E5%88%86%E6%9E%90%E9%97%AE%E9%A2%98/">&lt;&nbsp;NEWER</a>
          
            
</div>
        <div class="footer">
  
    <div class="footer-more">
      
        <a target="_blank" rel="noopener" href="https://github.com/leedom92/hexo-theme-leedom">Powered by Hexo</a>
        
    </div>
  
</div>

      </div>

      <div class="back-to-top hidden">
  <a href="javascript: void(0)">
    <i class="iconfont icon-chevronup"></i>
  </a>
</div>


<script src="/js/backtotop.js"></script>



      
  <div class="search-icon" id="search-icon">
    <a href="javascript: void(0)">
      <i class="iconfont icon-search"></i>
    </a>
  </div>

  <div class="search-overlay hidden">
    <div class="search-content" tabindex="0">
      <div class="search-box">
        <div class="search-title">
          <!-- <span class="search-icon-input">
            <a href="javascript: void(0)">
              <i class="iconfont icon-search"></i>
            </a>
          </span> -->
          
            <input type="text" class="search-input" id="search-input" placeholder="æœç´¢">
          
          <span class="search-close-icon" id="search-close-icon">
            <a href="javascript: void(0)">
              <i class="iconfont icon-close"></i>
            </a>
          </span>
        </div>
        <div class="search-result" id="search-result"></div>
      </div>
    </div>
  </div>

  <script type="text/javascript">
    var inputArea = document.querySelector("#search-input")
    var searchOverlayArea = document.querySelector(".search-overlay")

    // inputArea.onclick = function() {
    //   getSearchFile()
    //   this.onclick = null
    // }

    inputArea.onkeydown = function() {
      if(event.keyCode == 13)
        return false
    }

    function openOrHideSearchContent() {
      let isHidden = searchOverlayArea.classList.contains('hidden')
      if (isHidden) {
        searchOverlayArea.classList.remove('hidden')
        document.body.classList.add('hidden')
        inputArea.focus()
        getSearchFile()
      } else {
        searchOverlayArea.classList.add('hidden')
        document.body.classList.remove('hidden')
      }
    }

    function blurSearchContent(e) {
      if (e.target === searchOverlayArea) {
        openOrHideSearchContent()
      }
    }

    document.querySelector("#search-icon").addEventListener("click", openOrHideSearchContent, false)
    document.querySelector("#search-close-icon").addEventListener("click", openOrHideSearchContent, false)
    searchOverlayArea.addEventListener("click", blurSearchContent, false)

    var searchFunc = function (path, search_id, content_id) {
      'use strict';
      var $input = document.getElementById(search_id);
      var $resultContent = document.getElementById(content_id);
      $resultContent.innerHTML = "<ul><span class='local-search-empty'><span></ul>";
      // $resultContent.innerHTML = "<ul><span class='local-search-empty'>é¦–æ¬¡æœç´¢ï¼Œæ­£åœ¨è½½å…¥ç´¢å¼•æ–‡ä»¶ï¼Œè¯·ç¨åâ€¦â€¦<span></ul>";
      $.ajax({
        // 0x01. load xml file
        url: path,
        dataType: "xml",
        success: function (xmlResponse) {
          // 0x02. parse xml file
          var datas = $("entry", xmlResponse).map(function () {
            return {
              title: $("title", this).text(),
              content: $("content", this).text(),
              url: $("url", this).text()
            };
          }).get();
          $resultContent.innerHTML = "";

          $input.addEventListener('input', function () {
            // 0x03. parse query to keywords list
            var str = '<ul class=\"search-result-list\">';
            var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
            $resultContent.innerHTML = "";
            if (this.value.trim().length <= 0) {
              return;
            }
            // 0x04. perform local searching
            datas.forEach(function (data) {
              var isMatch = true;
              var content_index = [];
              if (!data.title || data.title.trim() === '') {
                data.title = "Untitled";
              }
              var orig_data_title = data.title.trim();
              var data_title = orig_data_title.toLowerCase();
              var orig_data_content = data.content.trim().replace(/<[^>]+>/g, "");
              var data_content = orig_data_content.toLowerCase();
              var data_url = data.url;
              var index_title = -1;
              var index_content = -1;
              var first_occur = -1;
              // only match artiles with not empty contents
              if (data_content !== '') {
                keywords.forEach(function (keyword, i) {
                  index_title = data_title.indexOf(keyword);
                  index_content = data_content.indexOf(keyword);

                  if (index_title < 0 && index_content < 0) {
                    isMatch = false;
                  } else {
                    if (index_content < 0) {
                      index_content = 0;
                    }
                    if (i == 0) {
                      first_occur = index_content;
                    }
                    // content_index.push({index_content:index_content, keyword_len:keyword_len});
                  }
                });
              } else {
                isMatch = false;
              }
              // 0x05. show search results
              if (isMatch) {
                str += "<li><a href='" + data_url + "' class='search-result-title'><h2>" + orig_data_title + "</h2></a>";
                var content = orig_data_content;
                if (first_occur >= 0) {
                  // cut out 100 characters
                  var start = first_occur - 20;
                  var end = first_occur + 80;

                  if (start < 0) {
                    start = 0;
                  }

                  if (start == 0) {
                    end = 100;
                  }

                  if (end > content.length) {
                    end = content.length;
                  }

                  var match_content = content.substr(start, end);

                  // highlight all keywords
                  keywords.forEach(function (keyword) {
                    var regS = new RegExp(keyword, "gi");
                    match_content = match_content.replace(regS, "<span class=\"search-keyword\">" + keyword + "</span>");
                  });

                  str += "<h3 class=\"search-result-abstract\">" + match_content + "...</h3>"
                }
                str += "<hr></li>";
              }
            });
            str += "</ul>";
            if (str.indexOf('<li>') === -1) {
              return $resultContent.innerHTML = "<ul><span class='local-search-empty'>æ²¡æœ‰æ‰¾åˆ°å†…å®¹ï¼Œè¯·å°è¯•æ›´æ¢æ£€ç´¢è¯ã€‚<span></ul>";
            }
            $resultContent.innerHTML = str;
          });
        },
        error: function(xhr, status, error) {
          $resultContent.innerHTML = ""
          if (xhr.status === 404) {
            $resultContent.innerHTML = "<ul><span class='local-search-empty'>æœªæ‰¾åˆ°search.xmlæ–‡ä»¶ï¼Œå…·ä½“è¯·å‚è€ƒï¼š<a href='https://github.com/leedom92/hexo-theme-leedom#configuration' target='_black'>configuration</a><span></ul>";
          } else {
            $resultContent.innerHTML = "<ul><span class='local-search-empty'>è¯·æ±‚å¤±è´¥ï¼Œå°è¯•é‡æ–°åˆ·æ–°é¡µé¢æˆ–ç¨åé‡è¯•ã€‚<span></ul>";
          }
        }
      });
      $(document).on('click', '#search-close-icon', function() {
        $('#search-input').val('');
        $('#search-result').html('');
      });
    }

    var getSearchFile = function() {
        var path = "/search.xml";
        searchFunc(path, 'search-input', 'search-result');
    }
  </script>




    </div>
  </body>
</html>
